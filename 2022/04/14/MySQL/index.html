<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mysql | ValcanoZz Blog</title><meta name="keywords" content="后端"><meta name="author" content="ValcanoZz"><meta name="copyright" content="ValcanoZz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQLSQL分类：  DDL：数据定义语言 Data Definition Language，负责数据结构定义与库对象定义的语言，由CREATE、ALTER与DROP三个语法所组成。  DML：数据操作语言 Data Manipulation Language，负责对数据库对象运行数据访问工作的指令集，以 INSERT、UPDATE、DELETE三种指令为核心，分别代表插入、更新与删除。  D">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql">
<meta property="og:url" content="http://example.com/2022/04/14/MySQL/index.html">
<meta property="og:site_name" content="ValcanoZz Blog">
<meta property="og:description" content="MySQLSQL分类：  DDL：数据定义语言 Data Definition Language，负责数据结构定义与库对象定义的语言，由CREATE、ALTER与DROP三个语法所组成。  DML：数据操作语言 Data Manipulation Language，负责对数据库对象运行数据访问工作的指令集，以 INSERT、UPDATE、DELETE三种指令为核心，分别代表插入、更新与删除。  D">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205151643159.png">
<meta property="article:published_time" content="2022-04-14T06:55:35.236Z">
<meta property="article:modified_time" content="2022-11-27T09:08:20.000Z">
<meta property="article:author" content="ValcanoZz">
<meta property="article:tag" content="后端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205151643159.png"><link rel="shortcut icon" href="/Notes/./img/favicon7.png"><link rel="canonical" href="http://example.com/2022/04/14/MySQL/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/Notes/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/Notes/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mysql',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 17:08:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="./css/v_footer.css"><link rel="stylesheet" href="./css/v_blog.css"><link rel="stylesheet" href="./css/v_cursors.css"><link rel="stylesheet" href="./css/v_opacity.css"><link rel="stylesheet" href="./css/v_scrollbar.css"><meta name="generator" content="Hexo 6.1.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/Notes/./img/avatar1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/Notes/archives/"><div class="headline">文章</div><div class="length-num">29</div></a></div><div class="data-item"><a href="/Notes/tags/"><div class="headline">标签</div><div class="length-num">14</div></a></div><div class="data-item"><a href="/Notes/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Notes/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/Notes/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/Notes/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/Notes/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Notes/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/Notes/about/"><i class="fa-fw fas fa- heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205151643159.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/Notes/">ValcanoZz Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Notes/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/Notes/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/Notes/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/Notes/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Notes/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/Notes/about/"><i class="fa-fw fas fa- heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Mysql</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-14T06:55:35.236Z" title="发表于 2022-04-14 14:55:35">2022-04-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T09:08:20.000Z" title="更新于 2022-11-27 17:08:20">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/Notes/categories/javaLearn/">javaLearn</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">26.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>98分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Mysql"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><p>SQL分类：</p>
<ul>
<li><p><strong>DDL：数据定义语言</strong></p>
<p>Data Definition Language，负责数据结构定义与库对象定义的语言，由<strong>CREATE</strong>、<strong>ALTER</strong>与<strong>DROP</strong>三个语法所组成。</p>
</li>
<li><p><strong>DML：数据操作语言</strong></p>
<p>Data Manipulation Language，负责对数据库对象运行数据访问工作的指令集，以 <strong>INSERT</strong>、<strong>UPDATE</strong>、<strong>DELETE</strong>三种指令为核心，分别代表插入、更新与删除。</p>
</li>
<li><p><strong>DQL：数据查询语言</strong></p>
<p>Data Query Language，负责进行数据查询而不会对数据本身进行修改的语句，这是最基本的SQL语句。保留字<strong>SELECT</strong>是DQL（也是所有SQL）用得最多的动词，其他DQL常用的保留字有<strong>FROM</strong>，<strong>WHERE</strong>，<strong>GROUP BY</strong>，<strong>HAVING</strong>和<strong>ORDER BY</strong>。</p>
</li>
<li><p><strong>DCL：数据控制语言</strong></p>
<p>Data Control Language，是一种可对数据访问权进行控制的指令，它可以控制特定用户账户对数据表、查看表、预存程序、用户自定义函数等数据库对象的控制权。由 <strong>GRANT</strong> 和 <strong>REVOKE</strong> 两个指令组成。DCL以控制用户的访问权限为主，GRANT为授权语句，对应的REVOKE是撤销授权语句。</p>
</li>
</ul>
<p>连接MySQL的指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 127.0.0.1 -P 3306 -u root -p密码</span><br></pre></td></tr></table></figure>

<p>-p密码不要有空格；</p>
<p>-h 后没有写ip地址，默认就是主机</p>
<p>-P 后没有写端口，默认就是3306</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u 用户名 -p密码  //直接进默认的MySQL？</span><br></pre></td></tr></table></figure>

<p>启动mysql服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start mysql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>进入mysql </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">输入密码 zzc</span><br></pre></td></tr></table></figure>
</blockquote>
<p>快捷键：</p>
<p>注释：shift + ctrl + c ； 注销注释：shift + ctrl + r</p>
<blockquote>
<p>注：</p>
<p>MySQL在&#x3D;&#x3D;Linux下&#x3D;&#x3D;数据库名、表名、列名、别名大小写规则是这样的：</p>
<ul>
<li>&#x3D;&#x3D;数据库名、表名、表的别名、变量名是严格区分大小写的&#x3D;&#x3D;；</li>
<li>关键字、函数名称在 SQL 中不区分大小写； </li>
<li>列名（或字段名）与列的别名（或字段别名）在所有的情况下均是忽略大小写的；</li>
</ul>
<p>MySQL在Windows的环境下全部不区分大小写</p>
</blockquote>
<blockquote>
<p>utf8mb4 能使用1~ 4个字节表示字符，utf8是utf8mb3的别名，能使用1 ~ 3个字节表示字符；</p>
<p>MySQL中有4个级别的字符集和计较规则：</p>
<ul>
<li>服务器级别 </li>
<li>数据库级别 </li>
<li>表级别 </li>
<li>列级别</li>
</ul>
<p>执行如下SQL语句： </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;character%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>会得到一些信息：</p>
<p>character_set_server：服务器级别的字符集<br>character_set_database：当前数据库的字符集<br>character_set_client：服务器解码请求时使用的字符集<br>character_set_connection：服务器处理请求时会把请求字符串从character_set_client转为character_set_connection<br>character_set_results：服务器向客户端返回数据时使用的字符集</p>
</blockquote>
<h1 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h1><p>创建与删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#删除数据库指令	</span><br><span class="line"><span class="keyword">DROP</span> DATABASE 数据库名</span><br><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> 数据库名 <span class="comment">-- 推荐</span></span><br><span class="line">    </span><br><span class="line">#创建数据库指令	</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名</span><br><span class="line"># 判断数据库是否已经存在，不存在则创建数据库（推荐）</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 数据库名;</span><br><span class="line"></span><br><span class="line">#创建一个使用utf8字符集的数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名 <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8</span><br><span class="line">#创建一个使用utf8字符集，并带校对规则的数据库 </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名 <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin</span><br><span class="line">#校对规则 utf8_bin区分大小写，默认utf8_general_ci 不区分大小写</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：DATABASE不能改名，一些可视化工具可以改名，是新建一个库，把所有表复制过去，再删旧库完成。</p>
</blockquote>
<p>查看数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#查看当前数据库服务器中的所有数据库</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES</span><br><span class="line">#查看当前正在使用的数据库，使用的一个mysql的全局函数</span><br><span class="line"><span class="keyword">SELECT</span> DATABASE()</span><br><span class="line"></span><br><span class="line"># 查看指定库下所有的表</span><br><span class="line"><span class="keyword">SHOW</span> TABLES <span class="keyword">FROM</span> 数据库名</span><br><span class="line"></span><br><span class="line">#查看前面创建的zzc_db01数据库的定义信息</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE zzc_db01</span><br><span class="line"></span><br><span class="line"># 切换数据库</span><br><span class="line">USE 数据库名</span><br></pre></td></tr></table></figure>

<p>修改数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE 数据库名 <span class="type">CHARACTER</span> <span class="keyword">SET</span> 字符集</span><br></pre></td></tr></table></figure>

<p>使用反引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#在创建数据库，表时，为了规避关键字，可以使用反引号解决,删除的时候也要带反引号</span><br><span class="line">#平时用的时候，带反引号更安全</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `<span class="keyword">CREATE</span>`</span><br></pre></td></tr></table></figure>

<p>备份与恢复</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#备份数据库（注意：在DOS执行; 这个备份的文件就是对应的<span class="keyword">sql</span>语句）:</span><br><span class="line">mysqldump <span class="operator">-</span>u 用户名 <span class="operator">-</span>p m <span class="operator">-</span>B 数据库<span class="number">1</span> 数据库<span class="number">2</span> 数据库n <span class="operator">&gt;</span> 文件路径名.spl</span><br><span class="line">#备份一个数据库中的若干表 (在DOS下执行)</span><br><span class="line">mysqldump <span class="operator">-</span>u 用户名 <span class="operator">-</span>p 数据库 表<span class="number">1</span> 表<span class="number">2</span> 表n <span class="operator">&gt;</span> 文件路径名.<span class="keyword">sql</span></span><br><span class="line">    </span><br><span class="line">#恢复数据库（注意：进入Mysql命令行再执行）：Source 文件路径名.<span class="keyword">sql</span></span><br><span class="line">source 文件路径名.<span class="keyword">sql</span></span><br><span class="line">#第二个恢复办法：将整个备份文件的内容放到查询编辑器中 执行一遍</span><br></pre></td></tr></table></figure>

<p>数据库CRUD</p>
<p>create，read，update，delete</p>
<hr>
<h1 id="表"><a href="#表" class="headerlink" title="表"></a>表</h1><h2 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h2><blockquote>
<p>DUAL表是一个虚拟的表，很特殊，是建立数据库的时候随数据字典创建而建立的，它是单行单列的一个表，一般称为“哑表、虚表等”，列名DUMMY，类型VARCHAR2(1)，值为’X’，</p>
</blockquote>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p> creat table 表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 表名</span><br><span class="line">(</span><br><span class="line">	field1 datatype,</span><br><span class="line">	field2 datatype</span><br><span class="line">)<span class="type">CHARACTER</span> <span class="keyword">SET</span> 字符集 <span class="keyword">COLLATE</span> 校对规则 ENGINE 存储引擎</span><br><span class="line">#field : 指定列名	datatype : 指定列类型（字段类型）</span><br><span class="line">#<span class="type">character</span> <span class="keyword">set</span> : 如果没有指定，则默认为所在数据库的字符集</span><br><span class="line">#<span class="keyword">collate</span> : 如果没有指定，则默认为所在数据库的校对规则</span><br><span class="line">#engine : 引擎</span><br><span class="line">#加上了IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>关键字，则表示：如果当前数据库中不存在要创建的数据表，则创建数据表；如果当前数据库中已经存在要创建的数据表，则忽略建表语句，不再创建数据表。</span><br><span class="line"></span><br><span class="line"># 将其他表的查询结果集作为新表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">AS</span> 查询语句</span><br><span class="line"></span><br><span class="line"># 查看表的数据结构</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#示例：</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t2`(</span><br><span class="line">	id <span class="type">INT</span> AUTO_INCREMENT, #自增</span><br><span class="line">	`name` <span class="type">VARCHAR</span>(<span class="number">255</span>),	 #name和password是关键字，要用反引号包起来</span><br><span class="line">	`password` <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">	birthday <span class="type">DATE</span></span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)  #主键</span><br><span class="line">)<span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin ENGINE INNODB;	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建表——方式2，基于现有的表创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">AS</span> 其他表<span class="operator">/</span>结果集</span><br><span class="line"></span><br><span class="line">#例子:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myemp</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> employee_id,name,salary <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>mysql8新特性：计算列 </p>
<p>—— 列名 generated always 公式 virtual</p>
<p>可以在create table 和 alter teble中使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb1(</span><br><span class="line">	a <span class="type">INT</span>,</span><br><span class="line">	b <span class="type">INT</span>,</span><br><span class="line">	c <span class="type">INT</span> GENERATED ALWAYS <span class="keyword">AS</span> (a <span class="operator">+</span> b) VIRTUAL	<span class="comment">-- 字段c为计算列</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


</blockquote>
<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><p>drop table 表名</p>
<p>drop是删除整个表，包括表的结构，约束，索引等。并释放掉所占的空间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名</span><br></pre></td></tr></table></figure>

<p>删除表的数据 : delete from 表名</p>
<p>delete不会减少表或索引占用的空间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t7 </span><br><span class="line">	<span class="keyword">WHERE</span> `<span class="keyword">day</span>` <span class="operator">=</span> <span class="number">1988</span>		#删除哪一行</span><br><span class="line">#如果没有<span class="keyword">where</span>语句，则删除表中的所有记录，<span class="keyword">delete</span>语句不会删除表本身</span><br><span class="line">#只能删行，不能删列（删列操作时<span class="keyword">alter</span> <span class="keyword">table</span>..drop..）</span><br></pre></td></tr></table></figure>

<p>TRUNCATE TABLE： truncate table语句删除表中所有的数据，重置表的自增值，会保留表结构及其约束，索引等。并使表和索引占用的空间恢复到初始大小。</p>
<h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><p> **insert into 表名 (可选列名) values (数据)，(数据) **</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t6`(	<span class="comment">--创建表</span></span><br><span class="line">	birthday <span class="type">DATE</span>,</span><br><span class="line">	job_time DATETIME,</span><br><span class="line">	login_time <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>		<span class="comment">--自动更新时间戳为登陆时间</span></span><br><span class="line">			     <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>);</span><br><span class="line">			     </span><br><span class="line">#添加数据：</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `t6`(birthday, job_time)</span><br><span class="line">	<span class="keyword">VALUES</span>(<span class="string">&#x27;2020-11-11&#x27;</span>,<span class="string">&#x27;2022-12-12 12:12:12&#x27;</span>),(....),(...);	<span class="comment">--往表中添加数据,可以一次添加多条数据，字符串类型和日期类应该用单引号包起来</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：如果是将查询结果插入表中，则不必写values：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 (可选列名) <span class="keyword">SELECT</span> ...</span><br><span class="line">#子查询中的列表应与<span class="keyword">INSERT</span>句中的列名对应</span><br></pre></td></tr></table></figure>


</blockquote>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p><strong>select , desc</strong> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">select</span> 查询；<span class="operator">*</span> 表示所有字段，可改为具体的多个列名； <span class="keyword">FROM</span> 从哪个表；<span class="keyword">WHERE</span> 从哪个字段(按条件查询)； </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `t1` <span class="keyword">WHERE</span> 列名 <span class="operator">=</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">#查询整张表</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `t1`</span><br><span class="line"></span><br><span class="line"># <span class="keyword">distinct</span>用于去重</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> 列名 <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件 </span><br><span class="line"></span><br><span class="line">#<span class="keyword">order</span> <span class="keyword">by</span> : 可以指定列名按值升序<span class="keyword">asc</span>或降序<span class="keyword">desc</span>排列</span><br><span class="line">#<span class="keyword">asc</span>：ascending <span class="keyword">order</span> 升序; <span class="keyword">desc</span>：descending <span class="keyword">order</span> 降序</span><br><span class="line"><span class="keyword">SELECT</span> 列名，运算表达式 <span class="keyword">FROM</span> 表m <span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名<span class="operator">/</span>表达式<span class="operator">/</span>别名 <span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span> #没写，默认升序</span><br><span class="line"></span><br><span class="line">#使用表达式对查询的列进行运算，可以用<span class="keyword">as</span>为列名和表达式换上别名，<span class="keyword">as</span>可以省略，直接后接别名</span><br><span class="line"><span class="keyword">SELECT</span> 列名 <span class="keyword">AS</span> 列别名, 运算表达式 <span class="keyword">AS</span> 表达式别名 <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line">#查看表结构，可以看所有列</span><br><span class="line"><span class="keyword">DESC</span> 表名</span><br></pre></td></tr></table></figure>

<p>where子语句中常用的</p>
<ul>
<li><p>比较运算符： <strong>&gt;	&lt;	 &lt;&#x3D;	&gt;&#x3D;	&#x3D;	&lt;&gt; 或 !&#x3D;</strong> (不等于，两种写法)	**between…and…**（显示在某一区间的值）	<strong>in(set)<strong>（显示在int列表中的值，如：in(10,20,30)）	<strong>like ‘赵%’    not like ‘赵%’</strong> （模糊查询：</strong>%匹配0到多个字符，_ 单个下划线匹配单个字符</strong>）	  <strong>is null</strong>（判断是否为空）	<br><strong>exists</strong> 指定一个子查询，检测 行 的存在。该子查询实际上并不返回任何数据，而是返回值True或False。</p>
</li>
<li><p>xx  <strong>all</strong> ( … )： all前的xx数据要大于括号内的所有数据，相当于 xx &gt; max ( … )</p>
<p>xx  <strong>any</strong> ( … )： all前的xx数据只要大于括号内的任一数据，相当于 xx &gt; min ( … )</p>
</li>
<li><p>逻辑运算符：<strong>and</strong>（多个条件同时成立）    <strong>or</strong>（多个条件任一成立）     <strong>not</strong>（条件需不成立）</p>
</li>
</ul>
<blockquote>
<p><strong>exists 练习</strong></p>
<p>有 学生表student（学号，姓名） ，课程表course（课程号，课程名），成绩表sc（学号，课程号，成绩）</p>
<p>（1）查询选修了所有课程的学生姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#由于<span class="keyword">SQL</span>中没有全称量词，所以一旦涉及到“全部”这个概念，就要用双重否定，这道题要考虑的是，对于 课程表里所有课程，查询这样的学生，没有一门课程是他不选修的。</span><br><span class="line"># 所以，将每个学生选修的课程一一列出与课程表所有课程进行比较！首先找出课程表中，每个学生没有选修的课；然后再挑出没有选修课为空集的学生返回即可。</span><br><span class="line"><span class="keyword">SELECT</span> s.姓名 <span class="keyword">FROM</span> student s <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">  (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> course c <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">   (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sc <span class="keyword">WHERE</span> sc.学号 <span class="operator">=</span> s.学号 <span class="keyword">AND</span> sc.课程号 <span class="operator">=</span> c.课程号));</span><br></pre></td></tr></table></figure>

<p>（2）使用嵌套查询，查询选修了学生S2所有课程的学生姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 首先要查找的学生选修课程包含了学生S2选修的全部课程。即要找到的:不存在哪一门课，学生S2选了，符合条件的学生没有选</span><br><span class="line"># 所以，将每个学生选修的课程一一列出与学生S2选修课程进行比较！首先找出S2课程表中，每个学生没有选修的课；然后再挑出没有选修课为空集的学生返回即可。</span><br><span class="line"><span class="keyword">SELECT</span> s.SNAME <span class="keyword">FROM</span> student s <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">  (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sc x <span class="keyword">WHERE</span> x.SNO <span class="operator">=</span> &quot;S2&quot; <span class="keyword">AND</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">  	  (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sc y <span class="keyword">WHERE</span> y.SNO <span class="operator">=</span> s.SNO <span class="keyword">AND</span> x.CNO <span class="operator">=</span> y.CNO));</span><br></pre></td></tr></table></figure>


</blockquote>
<hr>
<blockquote>
<p>注意：列的别名不能在where中使用。</p>
<p>因为select语句的执行顺序：</p>
<p>1.from语句<br>2.where语句（结合条件）<br>3.start with语句<br>4.connect by语句<br>6.group byi语句<br>7.having语句<br>8.model语句<br>9.select语句<br>10.union、ninus、intersect等集合演算演算<br>11.order by语句</p>
<p>12.limit语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#查询结构:</span><br><span class="line">方式<span class="number">1</span>：</span><br><span class="line"><span class="keyword">SELECT</span> ...,....,...</span><br><span class="line">	<span class="keyword">FROM</span> ...,...,....</span><br><span class="line">	<span class="keyword">WHERE</span> 多表的连接条件</span><br><span class="line">	<span class="keyword">AND</span> 不包含组函数的过滤条件</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> ...,...</span><br><span class="line">	<span class="keyword">HAVING</span> 包含组函数的过滤条件</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> ... <span class="keyword">ASC</span><span class="operator">/</span><span class="keyword">DESC</span></span><br><span class="line">	LIMIT ...,...</span><br><span class="line">#方式<span class="number">2</span>：</span><br><span class="line"><span class="keyword">SELECT</span> ...,....,...</span><br><span class="line">	<span class="keyword">FROM</span> ... </span><br><span class="line">	<span class="keyword">JOIN</span> ... <span class="keyword">ON</span> 多表的连接条件</span><br><span class="line">	<span class="keyword">JOIN</span> ... <span class="keyword">ON</span> ...</span><br><span class="line">	<span class="keyword">WHERE</span> 不包含组函数的过滤条件</span><br><span class="line">	<span class="keyword">AND</span><span class="operator">/</span><span class="keyword">OR</span> 不包含组函数的过滤条件</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> ...,...</span><br><span class="line">	<span class="keyword">HAVING</span> 包含组函数的过滤条件</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> ... <span class="keyword">ASC</span><span class="operator">/</span><span class="keyword">DESC</span></span><br><span class="line">	LIMIT ...,...</span><br><span class="line">#其中：</span><br><span class="line">#（<span class="number">1</span>）<span class="keyword">from</span>：从哪些表中筛选</span><br><span class="line">#（<span class="number">2</span>）<span class="keyword">on</span>：关联多表查询时，去除笛卡尔积</span><br><span class="line">#（<span class="number">3</span>）<span class="keyword">where</span>：从表中筛选的条件</span><br><span class="line">#（<span class="number">4</span>）<span class="keyword">group</span> <span class="keyword">by</span>：分组依据</span><br><span class="line">#（<span class="number">5</span>）<span class="keyword">having</span>：在统计结果中再次筛选</span><br><span class="line">#（<span class="number">6</span>）<span class="keyword">order</span> <span class="keyword">by</span>：排序</span><br><span class="line">#（<span class="number">7</span>）limit：分页</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202203192147883.png" alt="image-20220319214731765"></p>
</blockquote>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">select</span> ... limit <span class="keyword">start</span>, <span class="keyword">rows</span> </span><br><span class="line">#表示从<span class="keyword">start</span><span class="operator">+</span><span class="number">1</span>行开始取，取出<span class="keyword">rows</span>行，<span class="keyword">start</span>从<span class="number">0</span>开始计算</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> 列</span><br><span class="line">	LIMIT <span class="keyword">start</span>, <span class="keyword">rows</span></span><br></pre></td></tr></table></figure>

<p>select语句中如果包含了group by，having，order by，limit：则<strong>书写顺序为group by，having，order by，limit</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2... <span class="keyword">FROM</span> <span class="keyword">table</span> </span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">column</span></span><br><span class="line">	<span class="keyword">HAVING</span> <span class="keyword">condition</span></span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">column</span></span><br><span class="line">	LIMIT <span class="keyword">start</span>,<span class="keyword">rows</span>;</span><br></pre></td></tr></table></figure>



<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><p><strong>多表查询</strong>是基于两个或以上的表的查询，查询所规定的条件不能少于表的个数-1，否则会出现笛卡尔集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ename,sal,dname,emp.deptno</span><br><span class="line">	<span class="keyword">FROM</span> emp, dept	<span class="comment">-- 查询两张表</span></span><br><span class="line">	<span class="keyword">WHERE</span> emp.deptno <span class="operator">=</span> dept.deptno <span class="keyword">AND</span> emp.deptno <span class="operator">=</span> <span class="number">10</span>	<span class="comment">-- 不同表的列有同一名称时，要说明所属：表名.列名</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>表连接的约束条件可以有三种方式：WHERE, ON, USING</p>
</blockquote>
<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><p>自连接是指在同一张表的连接查询：将同一张表看作两张表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 给同一张表起不同别名，以达到自连接的目的</span><br><span class="line"><span class="keyword">SELECT</span> worker.ename, boss.ename </span><br><span class="line">	<span class="keyword">FROM</span> emp worker, emp boss  <span class="comment">-- 同一张表起不同的别名</span></span><br><span class="line">	<span class="keyword">WHERE</span> worker.mgr <span class="operator">=</span> boss.empno</span><br><span class="line">#也可使用 <span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line"><span class="keyword">SELECT</span> 字段列表</span><br><span class="line">	<span class="keyword">FROM</span> A表 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> B表</span><br><span class="line">	<span class="keyword">ON</span> 关联条件</span><br><span class="line">	<span class="keyword">WHERE</span> 等其他子句;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p>使用多表查询时，会根据关联条件显示匹配记录，而那些没有匹配到的记录则不会显示，如果在多表查询中至少需要显示表的全部内容，就要用到外连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> 表<span class="number">1</span></span><br><span class="line">	<span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 表<span class="number">1</span> 和 表<span class="number">2</span> 的连接条件</span><br><span class="line">	<span class="keyword">JOIN</span> 表<span class="number">3</span> <span class="keyword">ON</span> 表<span class="number">2</span> 和 表<span class="number">3</span> 的连接条件</span><br></pre></td></tr></table></figure>

<p>左外连接：让左侧的表完全显示，即左表为主表；</p>
<p>右外连接：让右侧的表完全显示；即右表为主表；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#左外连接</span><br><span class="line"><span class="keyword">SELECT</span> ... </span><br><span class="line">	<span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> 表<span class="number">2</span> </span><br><span class="line">	<span class="keyword">ON</span> 条件</span><br><span class="line">#右外连接	</span><br><span class="line"><span class="keyword">SELECT</span> ... </span><br><span class="line">	<span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> 表<span class="number">2</span> </span><br><span class="line">	<span class="keyword">ON</span> 条件	</span><br></pre></td></tr></table></figure>

<p>或者使用符号 (+) </p>
<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202203191935503.png" alt="image-20220319193504406"></p>
<blockquote>
<p>满外连接 FULL JOIN</p>
<p>满外连接的结果 &#x3D; 左右表匹配的数据 + 左表没有匹配到的数据 + 右表没有匹配到的数据。</p>
</blockquote>
<blockquote>
<p>各种关系的实现：</p>
<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202203191951879.png" alt="image-20220319195143639"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#中图：内连接 A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br><span class="line"></span><br><span class="line">#左上图：左外连接</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br><span class="line"></span><br><span class="line">#右上图：右外连接</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br><span class="line"></span><br><span class="line">#左中图：A <span class="operator">-</span> A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	<span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line">#右中图：B<span class="operator">-</span>A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	<span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line">#左下图：满外连接</span><br><span class="line"># 左中图 <span class="operator">+</span> 右上图 A∪B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	<span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> #没有去重操作，效率高</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br><span class="line"></span><br><span class="line">#右下图</span><br><span class="line">#左中图 <span class="operator">+</span> 右中图 A ∪B<span class="operator">-</span> A∩B 或者 (A <span class="operator">-</span> A∩B) ∪ （B <span class="operator">-</span> A∩B）</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	<span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	<span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p>natural join 用来表示自然连接。我们可以把 自然连接理解为 SQL92 中的等值连接。它会帮你自动查询两张连接表中 所有相同的字段 ，然后进行 等值连接 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#在SQL92中</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	<span class="keyword">AND</span> e.`manager_id` <span class="operator">=</span> d.`manager_id`;</span><br><span class="line">#使用自然连接:</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> departments d;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>USING</p>
<p>SQL99还支持使用 USING 指定数据表里的 同名字段 进行等值连接。但是只能配合JOIN一起使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">USING</span> (department_id);</span><br><span class="line">#等值于</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e ,departments d</span><br><span class="line">	<span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><p>子查询是指嵌入其他sql语句中的select语句，也叫嵌套查询</p>
<p>单行子查询：只返回一行数据的子查询语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 单行子查询：只返回一行数据的子查询语句</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">	<span class="keyword">FROM</span> emp</span><br><span class="line">	<span class="keyword">WHERE</span> deptno <span class="operator">=</span> (   <span class="comment">-- 只返回一行数据</span></span><br><span class="line">		<span class="keyword">SELECT</span> deptno</span><br><span class="line">			<span class="keyword">FROM</span> emp</span><br><span class="line">			<span class="keyword">WHERE</span> ename <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span> )</span><br><span class="line"></span><br><span class="line"># 多行子查询：返回多行数据的子查询语句</span><br><span class="line"><span class="keyword">select</span> ename, job, sal, deptno</span><br><span class="line">	<span class="keyword">from</span> emp</span><br><span class="line">	<span class="keyword">where</span> job <span class="keyword">in</span> (	<span class="comment">-- 返回了多行数据</span></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> job</span><br><span class="line">			<span class="keyword">FROM</span> emp</span><br><span class="line">			<span class="keyword">WHERE</span> deptno <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">	) <span class="keyword">and</span> deptno <span class="operator">!=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>还可以把子查询当作一张临时表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> goods_id, ecs_goods.cat_id, goods_name, shop_price</span><br><span class="line">	<span class="keyword">from</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> cat_id , <span class="built_in">MAX</span>(shop_price) <span class="keyword">as</span> max_price	<span class="comment">-- 子查询结果被当作临时表</span></span><br><span class="line">			<span class="keyword">FROM</span> ecs_goods </span><br><span class="line">        	<span class="keyword">GROUP</span> <span class="keyword">BY</span> cat_id</span><br><span class="line">	) temp , ecs_goods		<span class="comment">-- 其他表</span></span><br><span class="line">	<span class="keyword">where</span> temp.cat_id <span class="operator">=</span> ecs_goods.cat_id <span class="keyword">and</span> temp.max_price <span class="operator">=</span> ecs_goods.shop_priceQ</span><br></pre></td></tr></table></figure>

<blockquote>
<p>空值问题：</p>
<p>如果子查询的表中有NULL值，则使用NOT IN筛选子表时会出现问题：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> manager_id</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="comment">-- WHERE manager_id is not  NULL</span></span><br><span class="line">		);</span><br><span class="line"># 结果应该是排除子表筛出来的元素，但因为子表的结果集有<span class="keyword">NULL</span>值，所以最后结果是什么都没筛出来。	</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="合并查询"><a href="#合并查询" class="headerlink" title="合并查询"></a>合并查询</h4><p>操作符 union，union all 可以取得两个结果集的并集；</p>
<p>其中 union all 不会去重， union 会去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `name`, id <span class="keyword">FROM</span> table01 <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">2500</span> </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> `name`, id <span class="keyword">FROM</span> table01 <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;abab&#x27;</span></span><br></pre></td></tr></table></figure>





<h3 id="表复制"><a href="#表复制" class="headerlink" title="表复制"></a>表复制</h3><p>表的复制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#将表<span class="number">1</span>的数据复制添加到表<span class="number">2</span>，如果两表相同，则相当于自我复制</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表<span class="number">2</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表<span class="number">1</span></span><br><span class="line">#只复制部分数据：</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表<span class="number">2</span></span><br><span class="line">	(列，列 ...)</span><br><span class="line">	<span class="keyword">SELECT</span> 列，列... <span class="keyword">FROM</span> 表<span class="number">1</span></span><br><span class="line"></span><br><span class="line">#删除表<span class="number">1</span>中的重复记录</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表<span class="number">2</span> <span class="keyword">LIKE</span> 表<span class="number">1</span>	<span class="comment">-- 创建临时表2，于表1有相同的结构</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表<span class="number">2</span> 		</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表<span class="number">1</span>; <span class="comment">-- 将表1的数据复制到表2，同时去重(不重复添加)</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表<span class="number">1</span>;	<span class="comment">-- 删除表1的全部数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表<span class="number">1</span> 	</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表<span class="number">2</span>; <span class="comment">-- 将表2去重后的数据复制到表1</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表<span class="number">2</span>; <span class="comment">-- 删除临时表</span></span><br></pre></td></tr></table></figure>



<h3 id="修改列属性"><a href="#修改列属性" class="headerlink" title="修改列属性"></a>修改列属性</h3><p><strong>alter table</strong> 表名 <strong>add</strong> 内容 <strong>after</strong> 在哪之后&#x2F; <strong>modify</strong> 列名 属性更改&#x2F; <strong>drop</strong> 列名 &#x2F; <strong>character</strong> 字符集 &#x2F; <strong>change</strong> 旧名 新名 属性更改 ； <strong>rename</strong> 表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#添加列</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `t6` 		<span class="comment">--往表t6中添加</span></span><br><span class="line">	<span class="keyword">ADD</span> `name` <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>		<span class="comment">--添加列名：name，类型：VARCHAR，不允许为NULL，默认为&#x27;&#x27;</span></span><br><span class="line">	AFTER birthday				<span class="comment">--在列名birthday之后</span></span><br><span class="line">#修改列（的属性）</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `t6`</span><br><span class="line">	MODIFY `name` <span class="type">VARCHAR</span>(<span class="number">60</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>		<span class="comment">--修改name</span></span><br><span class="line">#删除列</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `t6`</span><br><span class="line">	<span class="keyword">DROP</span> `name`		<span class="comment">--删去name	</span></span><br><span class="line">#修改表名</span><br><span class="line">RENAME <span class="keyword">TABLE</span> t6 <span class="keyword">TO</span> t7			<span class="comment">--表明t6改为t7</span></span><br><span class="line">#修改表的字符集为utf8</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t7 </span><br><span class="line">	<span class="type">CHARACTER</span> utf8	</span><br><span class="line">#列名birthday修改为<span class="keyword">day</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t7 </span><br><span class="line">	CHANGE birthday `<span class="keyword">day</span>` <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>	</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 删除表 （不能回滚）</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名</span><br><span class="line">#清空表   （<span class="keyword">truncate</span>不能回滚，用<span class="keyword">delete</span>语句删除数据就可以回滚）</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> 表名</span><br></pre></td></tr></table></figure>



<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>update  表名 set 修改内容 where  位置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t7 			</span><br><span class="line">	<span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">1000</span>		#<span class="keyword">set</span>后接要更新的数据，可以有多个，用逗号分隔</span><br><span class="line">	<span class="keyword">WHERE</span> `name` <span class="operator">=</span> <span class="string">&#x27;aaa&#x27;</span>		#<span class="keyword">where</span>用于指定位置</span><br><span class="line">#如果没有<span class="keyword">where</span>语句,则更新所有的行(记录)	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果需要回滚数据，需要保证在DML前进行设置：set autocommit &#x3D; false;</p>
</blockquote>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>delete from 表名 where …</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments</span><br><span class="line">	<span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">#如果没有<span class="keyword">where</span>语句，则删除表中全部数据</span><br></pre></td></tr></table></figure>





<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><p>约束用于确保数据库的数据满足特定的商业规则；为保证数据完整性，一般从以下四个方面考虑限制：</p>
<ul>
<li><p>实体完整性（Entity Integrity） </p>
<p>例如：同一个表中，不能存在两条完全相同无法区分的记录 </p>
</li>
<li><p>域完整性（Domain Integrity） </p>
<p>例如：年龄范围0-120，性别范围“男&#x2F;女” </p>
</li>
<li><p>引用完整性（Referential Integrity） </p>
<p>例如：员工所在部门，在部门表中要能找到这个部门 </p>
</li>
<li><p>用户自定义完整性（User-defined Integrity） </p>
<p>例如：用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5倍。</p>
</li>
</ul>
<p>mysq的约束包括：</p>
<ul>
<li>not null，非空约束，规定某字段不能为空</li>
<li>unique，唯一约束，规定某字段在表中唯一</li>
<li>primary key， 主键约束（非空且唯一）</li>
<li>foreign key，外键约束</li>
<li>check，检查约束</li>
<li>default，默认值约束</li>
</ul>
<blockquote>
<p>查看某个表已有的约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints</span><br><span class="line">	<span class="keyword">WHERE</span> table_name <span class="operator">=</span> &quot;表名&quot;;</span><br><span class="line"># information_schema 系统库</span><br><span class="line"># table_constraints 专门存储各表的约束</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>注：MySQL不支持check约束，可以用，但没效果。</p>
</blockquote>
<h4 id="primary-key-主键"><a href="#primary-key-主键" class="headerlink" title="primary key (主键)"></a>primary key (主键)</h4><p>用于唯一的标识表行的数据，当定义主键约束后，该列不能重复；</p>
<ul>
<li>primary key约束列的数据不能重复，且不能为null</li>
<li>一张表最多只能有一个主键，但可以是复合主键：比如有列：name和id，可以将两者用一个主键约束，单个name或id可以重复，但name+id的组合不能有重复；</li>
<li>主键的指定方式有两种：<ul>
<li>在列定义 后指定：列定义  primary key</li>
<li>在表定义最后写 ：primary key (列名)</li>
</ul>
</li>
<li>主键名总是PRIMAR，对主键定义约束名没用；</li>
<li>使用desc 表名，可以看到primary key的情况；</li>
<li>开发中，每个表往往会设计一个主键，且建议不要修改主键字段的值，否则有破坏数据完整性的危险；</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#字段后 定义主键</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1(</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    `name` <span class="type">VARCHAR</span>(<span class="number">32</span>)</span><br><span class="line">);</span><br><span class="line">#表定义末尾 定义主键    </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1(</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    `name` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id,`name`)</span><br><span class="line">);    </span><br><span class="line"># 建表后</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (字段列表); </span><br></pre></td></tr></table></figure>

<p>删除主键约束：</p>
<p>删除主键时，不需指定主键名，因为一个表只有一个主键；删除主键约束后，非空约束会存在。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 <span class="keyword">drop</span> <span class="keyword">primary</span> key；</span><br></pre></td></tr></table></figure>

<p><strong>自增列 auto_increment</strong></p>
<ul>
<li><p>一个表最多只能有一个自增列；</p>
</li>
<li><p>自增列约束的必须是键列（主键列、唯一键列，即 primary key 或 unique ）；</p>
</li>
<li><p>自增列约束的列的数据类型必须是整数类型；</p>
</li>
<li><p>默认从1开始，也可用：alter table 表名auto_increment &#x3D; 新的开始值；</p>
<p>如果自增列指定了 0 和 null，会在当前基础上继续自增，如果指定了具体值，直接赋值为具体值。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 设置自增列</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名称(</span><br><span class="line">	字段名 数据类型 <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名称(</span><br><span class="line">	字段名 数据类型 <span class="keyword">unique</span> key auto_increment,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 modify 字段名 数据类型 auto_increment;</span><br><span class="line"></span><br><span class="line"># 删除自增列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 modify 字段名 数据类型; #修改有自增列的字段，不加auto_increment就相当于删除</span><br></pre></td></tr></table></figure>





<h4 id="not-null-非空"><a href="#not-null-非空" class="headerlink" title="not null (非空)"></a>not null (非空)</h4><p>在列上定义了not null，那么当插入数据时，必须为列提供数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 建表时</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp(</span><br><span class="line">	id <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	NAME <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	sex <span class="type">CHAR</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"># 建表后 </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp</span><br><span class="line">	MODIFY sex <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 删除非空约束</span><br><span class="line"># 去掉<span class="keyword">not</span> <span class="keyword">null</span>，相当于修改某个非注解字段，该字段允许为空</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 modify 字段名 数据类型 <span class="keyword">NULL</span>;	</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 modify 字段名 数据类型;</span><br></pre></td></tr></table></figure>



<h4 id="unique-唯一"><a href="#unique-唯一" class="headerlink" title="unique (唯一)"></a>unique (唯一)</h4><p>当定义了唯一约束后，该列的数据不能重复。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 <span class="keyword">UNIQUE</span></span><br></pre></td></tr></table></figure>

<ul>
<li>没有指定not null时，unique字段允许有多个null；</li>
<li>如果一个列， 约束了 unique not null ，则使用效果类似主键 primary key；</li>
<li>MySQL会给唯一约束的列上默认创建一个唯一索引。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 建表时</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名称(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	字段名 数据类型 <span class="keyword">unique</span>,</span><br><span class="line">	字段名 数据类型 <span class="keyword">unique</span> key,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名称(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	[<span class="keyword">constraint</span> 约束名] <span class="keyword">unique</span>(字段名)</span><br><span class="line">);</span><br><span class="line">#建表后</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 <span class="keyword">add</span> <span class="keyword">unique</span> (字段列表);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 modify 字段名 字段类型 <span class="keyword">unique</span>；</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 复合唯一约束</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	<span class="keyword">unique</span> key(字段列表) #字段列表中写的是多个字段名，多个字段名用逗号分隔，表示那么是复合唯一，即多个字段的组合是唯一的</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>删除唯一约束：</p>
<p>删除时需要指定唯一索引名（唯一索引名 和 唯一约束名一样，如果是复合约束且没有指定约束名，则默认为组合里的第一列的名）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> INDEX 唯一索引名</span><br></pre></td></tr></table></figure>



<h4 id="foreign-key-外键"><a href="#foreign-key-外键" class="headerlink" title="foreign key (外键)"></a>foreign key (外键)</h4><p>用于定义主表和从表之间的关系：’</p>
<p>外键约束主要定义在从表上，主表则必须具有主键约束或unique约束，当定义外键约束后，要求 外键列的数据必须在主表的主键列存在 或为null；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">foreign</span> key(...) <span class="keyword">references</span> 主表(...)</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(本表列名) <span class="keyword">REFERENCES</span> 主表名(主键名<span class="operator">/</span><span class="keyword">unique</span>字段名)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 主表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> class (</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY , <span class="comment">-- 班级编号</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 从表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuent (</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY , </span><br><span class="line">    class_id <span class="type">INT</span> , <span class="comment">-- 学生所在班级的编号</span></span><br><span class="line">	<span class="keyword">FOREIGN</span> KEY (class_id) <span class="keyword">REFERENCES</span> class(id)	<span class="comment">-- 指定外键关系</span></span><br><span class="line">) </span><br><span class="line"></span><br><span class="line"># 建表后</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">ADD</span> [<span class="keyword">CONSTRAINT</span> 约束名] <span class="keyword">FOREIGN</span> KEY (从表的字段) <span class="keyword">REFERENCES</span> 主表名(被引用字段) [<span class="keyword">on</span> <span class="keyword">update</span> xx][<span class="keyword">on</span> <span class="keyword">delete</span> xx];</span><br></pre></td></tr></table></figure>

<ul>
<li>表的类型需要是innodb，这样的表才支持外键；一个表可以有多个 外键；</li>
<li>外键列的类型要和主键列的类型一致(长度可以不同)；</li>
<li>一旦建立主外键关系，主键列数据就不能随意删除，需要先删除依赖该记录的数据，即对应外键列的所有同一数据，才能删除主键的这一数据。</li>
<li>当创建外键约束时，系统会默认在所在的列上建立对应的普通索引，索引名是外键的约束名（根据外键查询效率很高）；删除外键约束后，必须手动删除对应的索引。</li>
</ul>
<p><strong>约束等级：</strong></p>
<ul>
<li>Cascade方式 ：在父表上update&#x2F;delete记录时，同步update&#x2F;delete子表的匹配记录 </li>
<li>Set null方式 ：在父表上update&#x2F;delete记录时，将子表上匹配记录的列设为null，但是要注意子 表的外键列不能为not null </li>
<li>No action方式 ：如果子表中有匹配的记录，则不允许对父表对应候选键进行update&#x2F;delete操作 </li>
<li>Restrict方式 ：同no action， 都是立即检查外键约束 </li>
<li>Set default方式（在可视化工具SQLyog中可能显示空白）：父表有变更时，子表将外键列设置成一个默认的值，但Innodb不能识别。</li>
</ul>
<blockquote>
<p>对于外键约束，最好是采用: on update cascade on delete restrict 的方式。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">	did <span class="type">int</span> <span class="keyword">primary</span> key, #部门编号</span><br><span class="line">	dname <span class="type">varchar</span>(<span class="number">50</span>) #部门名称</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">	eid <span class="type">int</span> <span class="keyword">primary</span> key, #员工编号</span><br><span class="line">	ename <span class="type">varchar</span>(<span class="number">5</span>), #员工姓名</span><br><span class="line">	deptid <span class="type">int</span>, #员工所在的部门</span><br><span class="line">	<span class="keyword">foreign</span> key (deptid) <span class="keyword">references</span> dept(did) <span class="keyword">on</span> <span class="keyword">update</span> cascade <span class="keyword">on</span> <span class="keyword">delete</span> restrict	#把修改操作设置为级联修改等级，把删除操作设置为restrict等级</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</blockquote>
<p>删除外键约束： </p>
<p>查看约束名——删除外键约束——查看索引名——删除外键索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 第一步先查看约束名和删除外键约束</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints <span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;表名称&#x27;</span>; #查看某个表的约束名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键约束名;</span><br><span class="line"># 第二步查看索引名和删除索引。（注意，只能手动删除）</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> 表名称;  #查看某个表的索引名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">DROP</span> INDEX 索引名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>外键约束是用于保证数据的参照完整性的，因此主表与从表的存储引擎需要一致。</p>
<p>建不建外键约束和查询有没有关系。</p>
<blockquote>
<p>在 MySQL 里，外键约束是有成本的，需要消耗系统资源。对于大并发的 SQL 操作，有可能会不适 合。比如大型网站的中央数据库，可能会因为外键约束的系统开销而变得非常慢 。</p>
<p>所以，MySQL 允许不使用系统自带的外键约束，在应用层面完成检查数据一致性的逻辑。</p>
</blockquote>
<p><strong>阿里开发规范：不得使用外键与级联，一切外键概念必须在应用层解决。</strong></p>
<blockquote>
<p>级联更新：主键更新，外键跟着更新；</p>
<p>外键与级联更新 适用于单机低并发 ，不适合 分布式 、 高并发集群 ；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度 。</p>
</blockquote>
</blockquote>
<p>​                  </p>
<h4 id="check"><a href="#check" class="headerlink" title="check"></a>check</h4><p>用于强制数据必须满足的条件</p>
<p>（oracle和sql server支持check，mysql8.0才支持check）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">列名 类型 <span class="keyword">CHECK</span>(<span class="keyword">check</span>条件)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> temp(</span><br><span class="line">	id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">	NAME <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	age <span class="type">INT</span> <span class="keyword">CHECK</span>(age <span class="operator">&gt;</span> <span class="number">20</span>),</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h4 id="default"><a href="#default" class="headerlink" title="default"></a>default</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 默认值一般不加在唯一键和主键列上</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名称(</span><br><span class="line">	字段名 数据类型 <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> 默认值,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名称 modify 字段名 数据类型 <span class="keyword">default</span> 默认值; #如果字段原来有非空约束，并且要保留，需要在此句加上<span class="keyword">not</span> <span class="keyword">null</span>，否则非空约束会被删除</span><br></pre></td></tr></table></figure>

<blockquote>
<p>建表时，通常会加 not null default ‘’ 或  default 0，因为：</p>
<ul>
<li>null是特殊的值，比较时只能用专门的 is null 和 is not null 来比较。碰到运算符，通 常返回null。 </li>
<li>效率不高，影响提高索引效果。</li>
</ul>
</blockquote>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引可以极大加快查询的速度；</p>
<ul>
<li>使用索引会为该列形成一个索引的数据结构，如索引二叉树；</li>
<li>代价：额外占用磁盘空间；对dml语句(update, delete, insert) 的效率有影响，因为数据变动时需要重新维护索引结构</li>
<li>一般使用中，查询操作比增删改操作要多很多，因此索引很有必要</li>
</ul>
<blockquote>
<p>更新一个包含索引的表需要比更新一个没有索引的表更多的时间，这是由于索引本身也需要更新。因此，理想的做法是仅仅在常常被搜索的列（以及表）上面创建索引。</p>
</blockquote>
<p>索引的类型：</p>
<ul>
<li>主键索引：主键就是一个索引</li>
<li>唯一索引（unique）</li>
<li>普通索引（index）</li>
<li>全文索引：不适用mysql自带的fulltext，而是使用全文搜索Solr和ElasticSearch（ES）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#建表后 创建索引</span><br><span class="line"><span class="keyword">CREATE</span> 索引名 <span class="keyword">ON</span> 表名 (列名 [长度] [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>])</span><br><span class="line"></span><br><span class="line">#建表时 创建索引</span><br><span class="line">INDEX [索引名] [索引类型] (列名,…)</span><br><span class="line"><span class="keyword">UNIQUE</span> [ INDEX ] [索引名] [索引类型] (列名,…)</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY 索引名 列名</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#建表时</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `order_table`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_table`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `上架单` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `型号代码` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,	#主键索引的数据结构用B树</span><br><span class="line">  INDEX `idx_orderno`(`上架单`,`型号代码`) <span class="keyword">USING</span> BTREE,   #使用B树作为索引的数据结构</span><br><span class="line">) </span><br><span class="line"></span><br><span class="line">#建表后</span><br><span class="line">#为列创建索引：</span><br><span class="line"><span class="comment">-- create index .. on ..</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX 索引名 <span class="keyword">ON</span> 表(列) <span class="comment">-- 唯一索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX 索引名 <span class="keyword">ON</span> 表(列) <span class="comment">-- 普通索引</span></span><br><span class="line"><span class="comment">-- alter table .. add index ..</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表 <span class="keyword">ADD</span> INDEX 索引名(列)</span><br><span class="line"></span><br><span class="line">#删除索引</span><br><span class="line"><span class="keyword">DROP</span> INDEX 索引名 <span class="keyword">ON</span> 表</span><br><span class="line">#删除主键索引</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY</span><br><span class="line"></span><br><span class="line">#修改索引：先删除，再修改</span><br><span class="line"></span><br><span class="line">#查询索引</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> 表</span><br><span class="line"><span class="keyword">SHOW</span> INDEXES <span class="keyword">FROM</span> 表</span><br><span class="line"><span class="keyword">SHOW</span> KEYS <span class="keyword">FROM</span> 表</span><br><span class="line"><span class="keyword">DESC</span> 表</span><br></pre></td></tr></table></figure>

<p>索引使用：</p>
<p>频繁的作为查询条件的字段应创建索引；</p>
<p>唯一性太差的字段不适合单独创建索引，即使频繁查询；更新很频繁的字段也不适合创建索引（因为维护索引结构需要额外开销）；不会或极少作为查询条件出现的字段也不用创建索引</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>事务用于保证数据的一致性，事务期间的操作要么全部成，要么全部失败。</p>
<p>当执行事务操作时（dml语句），mysql会在表上加锁，防止其他用户修改表；</p>
<p>mysql的事务机制需要设置innodb的存储引擎才能使用</p>
<p><strong>事务ACID特性</strong>：</p>
<ul>
<li><strong>原子性（Atomicity）</strong>：原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生；</li>
<li><strong>一致性（Consistency）</strong>：事务必须使数据库从一个一致性状态变换到另一个一致性状态</li>
<li><strong>隔离性（Isolation）</strong>：事务的隔离性使多个用户并发访问数据库时，数据库未每个用户开启的事务不能被其他事务的操作所干扰，多个并发事务之间要相互隔离；</li>
<li><strong>持久性（Durability）</strong>：持久性是指一个事务一旦被提交，它对数据库中数据的改变是永久性的，即使数据库发生故障也不应该对其有影响</li>
</ul>
<h4 id="事务操作"><a href="#事务操作" class="headerlink" title="事务操作"></a>事务操作</h4><ul>
<li><p><strong>start transaction</strong> ：开启一个事务 （或者：set autocommit &#x3D; off ，即关闭自动提交）</p>
</li>
<li><p><strong>savepoint</strong>：设置保存点</p>
</li>
<li><p><strong>rollback to</strong> ：回退到某个保存点，回退后，会删除此保存点 以及 在其之后设置的保存点</p>
</li>
<li><p><strong>rollback</strong> ：回退全部事务，即回到事务开始的时候</p>
</li>
<li><p><strong>commit</strong>：提交事务，所有操作生效，不能再回退（确认事务的变化—结束事务—删除保存点—释放锁—数据生效）</p>
</li>
</ul>
<blockquote>
<p>DDL和DML的说明：</p>
<ul>
<li>DDL的操作一旦执行，就不可回滚；</li>
<li>DML的操作默认情况也不可回滚；想要回滚，需要在操作前设置：SET autocommit &#x3D; FALSE；</li>
</ul>
</blockquote>
<h4 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h4><table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>加锁读</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交(Read uncommitted)</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>不加锁</td>
</tr>
<tr>
<td>读已提交(Read committed)</td>
<td>N</td>
<td>Y</td>
<td>Y</td>
<td>不加锁</td>
</tr>
<tr>
<td>可重复读(Repeatable read)</td>
<td>N</td>
<td>N</td>
<td>Y</td>
<td>不加锁</td>
</tr>
<tr>
<td>可串行化(Serializable)</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>加锁</td>
</tr>
</tbody></table>
<p>脏读：当一个事务读取另一个事务还未提交的改变时，产生脏读</p>
<p>不可重复读：由于其他事务所提交的修改或删除操作，致使在同一事务中的同一查询返回不同结果，即发生不可重复读</p>
<p>幻读：由于其他事务所提交的插入操作，致使在同一事务中的同一查询返回不同结果，即发生幻读</p>
<p><strong>事务隔离级别操作：</strong></p>
<ul>
<li><p>设置当前会话隔离级别：</p>
<p>set session transaction isolation level <u>repeattable read</u>;</p>
<p>设置系统当前隔离级别：</p>
<p>set global transaction isolation level <u>repeattable read</u>;</p>
</li>
<li><p>查看当前会话隔离级别：</p>
<p><code>select @@tx_isolation;</code></p>
<p>查看系统当前隔离级别：</p>
<p><code>select @@global.tx_isolation;</code></p>
</li>
<li><p>mysql默认的事务隔离级别是repeatable read，一般都用，无需修改；</p>
</li>
<li><p>全局修改：直接修改my.ini配置文件，在末尾加上：</p>
<p><code>#可选参数有：READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ, SERIALIZABLE</code></p>
<p><code>[mysqld]</code></p>
<p><code>transaction-isolation = REPEATABLE-READ</code></p>
</li>
</ul>
<h2 id="表类型-x2F-存储引擎"><a href="#表类型-x2F-存储引擎" class="headerlink" title="表类型&#x2F;存储引擎"></a>表类型&#x2F;存储引擎</h2><p>mysql的表类型由存储引擎（Storage Engines）决定，</p>
<p>MySQL数据表主要支持六种类型：CSV，Memory，ARCHIVE，MRG_MYISAM，MYISAM，InnoDB；</p>
<p>其中<strong>InnoDB为事务安全型</strong>，其他五种为非事务安全型；</p>
<p>MYISAM：不支持事务，不支持外键，但访问速度快</p>
<p>InnoDB：支持事务安全，但读写的处理效率相比MYISAM差一些，且会占用更多的磁盘空间以保留数据和索引；</p>
<p>MEMORY：使用存在内存中的内容来创建表，每个MEMORY表实际对应一个磁盘文件。MEMORY类型的表访问非常快，因为它的数据放在内存中，且默认使用hash索引；但如果MySQL服务关闭，表中的数据就会丢失，而表的结构还在</p>
<p>修改存储引擎：</p>
<p><code>alter table 表名 engine = 存储引擎</code></p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是一个虚拟表，其内容由查询定义，同真实的表一样，视图包括列，其数据来自对应的基表（可以是多个基表）。通过视图可以修改基表的数据，基表的改变也会影响视图的数据。（视图中可以再使用视图，数据仍来自基表）</p>
<p>操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#创建：</span><br><span class="line">creat <span class="keyword">view</span> 视图名 <span class="keyword">as</span> <span class="keyword">select</span> 语句</span><br><span class="line"></span><br><span class="line">#修改：</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> 视图名 <span class="keyword">as</span> <span class="keyword">select</span></span><br><span class="line"></span><br><span class="line">#显示创建视图的指令：</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> 视图名</span><br><span class="line"></span><br><span class="line">#删除视图：</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> 视图名<span class="number">1</span>,视图名<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>视图的好处：</p>
<ul>
<li>安全：可以只让用户查询到需要的字段，一些保密的字段不能查看。</li>
<li>性能：视图存储的是查询语句，本身并不占用数据存储资源，减少了数据冗余。</li>
<li>灵活：可以在旧表上建立一张视图，然后映射到新表上，达到升级数据表的目的。</li>
</ul>
<p>视图的不足：</p>
<p>如果实际数据表的结构变更了，我们就需要及时对相关的视图进行相应的维护。特别是嵌套的视图（就是在视图的基础上创建视图），维护会变得比较复杂， 可读性不好 ，容易变成系统的潜在隐患。</p>
<p>实际项目中，如果视图过多，会导致数据库维护成本的问题。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查看视图</span><br><span class="line"># 查看数据库的表对象、视图对象</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"># 查看视图的结构</span><br><span class="line"><span class="keyword">DESC</span> 视图名;</span><br><span class="line"></span><br><span class="line"># 查看视图的属性信息</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;视图名&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查看视图的详细定义信息</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 更新视图，跟更新表一样</span><br><span class="line"><span class="keyword">update</span> 视图名 <span class="keyword">set</span> 更新内容 <span class="keyword">where</span> ...</span><br><span class="line"></span><br><span class="line"># 删除数据，跟删除表数据一样</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 视图名 <span class="keyword">where</span> ...</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 修改视图</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> 视图名 <span class="keyword">as</span> 查询语句</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> 视图名称 <span class="keyword">as</span> 查询语句</span><br><span class="line"># 删除视图</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> if <span class="keyword">exists</span> 视图<span class="number">1</span>，视图<span class="number">2</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>视图作为虚拟表，主要用于 方便查询，不建议更新视图数据。</p>
</li>
<li><p>对视图数据的更改，都是通过对实际数据表的更新来完成。</p>
</li>
</ul>
<blockquote>
<p>一些不可更新的视图：</p>
<p>要使视图可更新，视图中的行和底层基本表中的行之间必须存在 一对一 的关系。</p>
<p>另外当视图定义出现如下情况时，视图不支持更新操作：</p>
<ul>
<li>在定义视图的时候指定了“ALGORITHM &#x3D; TEMPTABLE”，视图将不支持INSERT和DELETE操作； </li>
<li>视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT操作；</li>
<li>在定义视图的SELECT语句中使用了 JOIN联合查询 ，视图将不支持INSERT和DELETE操作； </li>
<li>在定义视图的SELECT语句后的字段列表中使用了 数学表达式 或 子查询 ，视图将不支持INSERT，也不支持UPDATE使用了数学表达式、子查询的字段值； </li>
<li>在定义视图的SELECT语句后的字段列表中使用 DISTINCT 、 聚合函数 、 GROUP BY 、 HAVING 、 UNION 等，视图将不支持INSERT、UPDATE、DELETE；</li>
<li>在定义视图的SELECT语句中包含了子查询，而子查询中引用了FROM后面的表，视图将不支持 INSERT、UPDATE、DELETE； </li>
<li>视图定义基于一个 不可更新视图 ； </li>
<li>常量视图。</li>
</ul>
</blockquote>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>mysql的用户，都存储在系统数据库mysql中的user表中;</p>
<p>user表的重要字段说明：</p>
<ul>
<li><strong>host</strong>：允许登录的“位置”&#x2F;IP，可以指定ip地址登录；其中localhost表示该用户只允许本机登录；</li>
<li><strong>user</strong>：用户名；</li>
<li><strong>authentication_string</strong>：密码，用mysql的password()函数加密过的密码字段</li>
</ul>
<p><strong>操作：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#创建用户，并指定密码：</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span> @<span class="string">&#x27;允许登录位置&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span></span><br><span class="line"><span class="comment">-- 指定host时，可以写 % ，表示所有IP都有连接权限;IP也可以写成 192.168.1.% , 表示某用户的ip为 192.168.1.% z</span></span><br><span class="line"></span><br><span class="line">#删除用户：</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span> @<span class="string">&#x27;允许登录位置&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#修改密码：</span><br><span class="line"><span class="comment">-- 修改自己的密码：</span></span><br><span class="line"><span class="keyword">set</span> password <span class="operator">=</span> password(<span class="string">&#x27;密码&#x27;</span>);</span><br><span class="line"><span class="comment">-- 修改他人的密码(需要有修改用户密码的权限):</span></span><br><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> <span class="string">&#x27;用户名&#x27;</span> @<span class="string">&#x27;登录位置&#x27;</span> <span class="operator">=</span> password(<span class="string">&#x27;密码&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>用户权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 给用户权限：</span><br><span class="line"><span class="keyword">grant</span> 权限列表 <span class="keyword">on</span> 库.对象名 <span class="keyword">to</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;登录位置&#x27;</span> [identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span>]</span><br><span class="line"><span class="comment">-- 说明：权限列表写all表示赋予该用户在该对象上的所有权限</span></span><br><span class="line"><span class="comment">-- 库.对象名 写成 *.* : 代表系统中的所有数据库的所有对象(表，视图，存储过程); 写成 库.* : 代表某个数据库的所有数据对象(表，视图，存储过程);</span></span><br><span class="line"><span class="comment">-- identified by 可以省略，1.如果用户存在，就是修改该用户的密码; 2.如果该用户不存在，就是创建该用户;</span></span><br><span class="line"></span><br><span class="line">#回收用户权限：</span><br><span class="line"><span class="keyword">revoke</span> 权限列表 <span class="keyword">on</span> 库.对象名 <span class="keyword">from</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;登录位置&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#权限生效指令(如果权限没有生效，可以执行此命令)</span><br><span class="line">flush privileges</span><br></pre></td></tr></table></figure>









<hr>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><blockquote>
<p>不同DBMS采用的函数有所不同，因此使用了SQL函数的代码，往往可移植性较差。</p>
</blockquote>
<h2 id="统计函数"><a href="#统计函数" class="headerlink" title="统计函数"></a>统计函数</h2><p>count, sum, avg, max, min</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="built_in">count</span>(<span class="operator">*</span>)会返回满足条件的记录的个数，<span class="built_in">count</span>(列名)同样返回满足条件的列的个数，但会排除为<span class="keyword">null</span>的情况</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件</span><br><span class="line"></span><br><span class="line">#<span class="built_in">sum</span>(列)返回满足条件的列的所有数值的总和(sum仅对数值起作用，对字符等没有意义; 对多列求和，逗号不能少)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(列名)，<span class="built_in">SUM</span>(列名)...<span class="keyword">FROM</span> 表明；</span><br><span class="line"></span><br><span class="line">#avg返回满足条件的列的平均值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(列名) <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line">#max<span class="operator">/</span>min 返回满足列的最高值<span class="operator">/</span>最低值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(列名) <span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(列名) <span class="keyword">FROM</span> 表名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>where 不能使用统计函数。</p>
</blockquote>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>group by .. having …. （having可对分组后结果进行过滤）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列, 列(可以是函数), 分组的列名 <span class="keyword">FROM</span> 表名 </span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组的列名 <span class="keyword">HAVING</span> 过滤条件</span><br></pre></td></tr></table></figure>

<p>对比where和having：</p>
<table>
<thead>
<tr>
<th></th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>WHERE</td>
<td>先筛选数据再关联，执行效率高</td>
<td>不能使用分组中的计算函数进行筛选</td>
</tr>
<tr>
<td>HAVING</td>
<td>可以使用分组中的计算函数</td>
<td>在最后的结果集中进行筛选，执行效率较低</td>
</tr>
</tbody></table>
<h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#charset(str) 返回字串的字符集</span><br><span class="line"><span class="keyword">SELECT</span> CHARSET(列名) <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line">#concat(string1,string2...) 连接字符，可将多个列拼接成一列</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(列名,<span class="string">&#x27;string&#x27;</span>,列名) <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line">#instr(stirng, substring) 返回substring在string中出现的位置，没有则放回<span class="number">0</span></span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;STRING&#x27;</span>,<span class="string">&#x27;RING&#x27;</span>) <span class="keyword">FROM</span> DUAL  #dual 亚元表，是系统表，可用于测试表使用</span><br><span class="line"></span><br><span class="line">#ucase(stirng) 转换成大写</span><br><span class="line">#lcase(stirng) 转换成小写</span><br><span class="line"><span class="keyword">SELECT</span> UCASE(列名) <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line">#<span class="keyword">left</span>(string, length) 从string中的左边起取length个字符</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(列名，<span class="number">2</span>) <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line">#length(string) 返回string长度(按字节算)</span><br><span class="line"></span><br><span class="line">#replace(str, search_str, replace_str) 在str中用replace_str替换search_str</span><br><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>， REPLACE(列名<span class="number">2</span>，<span class="string">&#x27;search_str&#x27;</span>,<span class="string">&#x27;replace_str&#x27;</span>) <span class="keyword">FROM</span> 表名 </span><br><span class="line"><span class="comment">/*搜索列名1，如果每行的列名2中有search_str，就用replace_str替换*/</span></span><br><span class="line"></span><br><span class="line">#strcmp(srting1, string2) 逐字符比较两字符大小</span><br><span class="line"></span><br><span class="line">#<span class="built_in">substring</span>(str, position, length) 从str的position开始(从<span class="number">1</span>开始计算)，取length个字符</span><br><span class="line"></span><br><span class="line">#ltrim(string) <span class="operator">/</span> rtrim(string) 取出前端空格<span class="operator">/</span>后端空格</span><br></pre></td></tr></table></figure>

<h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- abs(num) 绝对值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-10</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- bin(decimal_number )十进制转二进制</span></span><br><span class="line"><span class="keyword">SELECT</span> BIN(<span class="number">10</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- hex(DecimalNumber ) 转十六进制</span></span><br><span class="line"><span class="comment">-- oct(DecimalNumber ) 转八进制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ceiling(number2 ) 向上取整, 得到比 num2 大的最小整数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEILING</span>(<span class="number">-1.1</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- floor(number2 ) 向下取整,得到比 num2 小的最大数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">-1.1</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- conv(number2,from_base,to_base) 进制转换</span></span><br><span class="line"><span class="comment">-- 下面的含义是: 8 是十进制的, 转成 二进制输出</span></span><br><span class="line"><span class="keyword">SELECT</span> CONV(<span class="number">8</span>, <span class="number">10</span>, <span class="number">2</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="comment">-- 下面的含义是: 8 是 16 进制的, 转成 十进制输出</span></span><br><span class="line"><span class="keyword">SELECT</span> CONV(<span class="number">16</span>, <span class="number">16</span>, <span class="number">10</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- format(number,decimal_places ) 保留小数位数(四舍五入)</span></span><br><span class="line"><span class="keyword">SELECT</span> FORMAT(<span class="number">78.125458</span>,<span class="number">2</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- least(number , number2 [,..]) 求最小值</span></span><br><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="number">0</span>,<span class="number">1</span>, <span class="number">-10</span>, <span class="number">4</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- mod(numerator ,denominator)  求余</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>, <span class="number">3</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- rand([seed]) RAND([seed]) 返回随机数 其范围为 0 ≤ v ≤ 1.0</span></span><br><span class="line"><span class="comment">-- 1. 如果使用 rand(), 每次返回不同的随机数 ，在 0 ≤ v ≤ 1.0</span></span><br><span class="line"><span class="comment">-- 2. 如果使用 rand(seed) 返回随机数, 范围 0 ≤ v ≤ 1.0, 如果seed不变，该随机数也不变(固定了)</span></span><br><span class="line"><span class="keyword">SELECT</span> RAND() <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<h2 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CURRENT_DATE ( ) 当前日期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_DATE</span>() <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURRENT_TIME ( )当前时间</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIME</span>() <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURRENT_TIMESTAMP ( ) 当前时间戳</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>() <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line">#NOW() 返回当前时间</span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line">#date_add(data,<span class="type">interval</span> d_value d_type) 在<span class="type">date</span>中加上日期或时间</span><br><span class="line">#<span class="type">interval</span> 后可以是 <span class="keyword">year</span>，<span class="keyword">minute</span>，<span class="keyword">second</span>，<span class="keyword">day</span>等</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mes <span class="keyword">WHERE</span> DATE_ADD(send_time, <span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">MINUTE</span>) <span class="operator">&gt;=</span> NOW()</span><br><span class="line">#date_sub(data,<span class="type">interval</span> d_value d_type) 在<span class="type">date</span>中减去日期或时间</span><br><span class="line">#<span class="type">interval</span> 后可以是 <span class="keyword">year</span>，<span class="keyword">minute</span>，<span class="keyword">second</span>，<span class="keyword">hour</span>，<span class="keyword">day</span>等</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mes <span class="keyword">WHERE</span> send_time <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">MINUTE</span>)</span><br><span class="line"></span><br><span class="line">#datediff(date1, date2) 两个日期差(天)</span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2011-11-11&#x27;</span>, <span class="string">&#x27;1990-01-01&#x27;</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- YEAR|Month|DAY| DATE (datetime )</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW()) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="string">&#x27;2013-11-10&#x27;</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- unix_timestamp() : 返回的是 1970-1-1 到现在的秒数</span></span><br><span class="line"><span class="keyword">SELECT</span> UNIX_TIMESTAMP() <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 格式化日期</span></span><br><span class="line">DATE_FORMAT(<span class="type">date</span>,fmt) <span class="comment">-- 按照字符串fmt格式化日期date值</span></span><br><span class="line">TIME_FORMAT(<span class="type">time</span>,fmt) <span class="comment">-- 按照字符串fmt格式化时间time值</span></span><br><span class="line">GET_FORMAT(date_type,format_type) <span class="comment">-- 返回日期字符串的显示格式</span></span><br><span class="line">STR_TO_DATE(str, fmt) <span class="comment">-- 按照字符串fmt对str进行解析，解析为一个日期</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>常用格式符:</p>
<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202203192048867.png" alt="image-20220319204809732"></p>
<p>常用取值：</p>
<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202203192049029.png" alt="image-20220319204902891"></p>
</blockquote>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建测试表 信息表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mes(</span><br><span class="line">    id <span class="type">INT</span> ,</span><br><span class="line">    content <span class="type">VARCHAR</span>(<span class="number">30</span>), </span><br><span class="line">    send_time DATETIME</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 添加一条记录</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mes <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;北京新闻&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mes <span class="keyword">VALUES</span>(<span class="number">2</span>, <span class="string">&#x27;上海新闻&#x27;</span>, NOW());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mes <span class="keyword">VALUES</span>(<span class="number">3</span>, <span class="string">&#x27;广州新闻&#x27;</span>, NOW());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mes;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示所有新闻信息，发布日期只显示 日期，不用显示时间. </span></span><br><span class="line"><span class="keyword">SELECT</span> id, content, <span class="type">DATE</span>(send_time) <span class="keyword">FROM</span> mes; </span><br><span class="line"><span class="comment">-- 查询在 10 分钟内发布的新闻</span></span><br><span class="line">#date_add(data,<span class="type">interval</span> d_value d_type) 在<span class="type">date</span>中加上日期或时间</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mes <span class="keyword">WHERE</span> DATE_ADD(send_time, <span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">MINUTE</span>) <span class="operator">&gt;=</span> NOW()</span><br><span class="line">#date_sub(data,<span class="type">interval</span> d_value d_type) 在<span class="type">date</span>中减去日期或时间</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mes <span class="keyword">WHERE</span> send_time <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">10</span> <span class="keyword">MINUTE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求出 2011-11-11 和 1990-1-1 相差多少天</span></span><br><span class="line">#datediff(date1, date2) 两个日期差(天)</span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2011-11-11&#x27;</span>, <span class="string">&#x27;1990-01-01&#x27;</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"><span class="comment">-- 求出你活了多少天? (假如1986-11-11 出生)</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(NOW(), <span class="string">&#x27;1986-11-11&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果你能活 80 岁，求出你还能活多少天. (1986-11-11 出生)</span></span><br><span class="line"><span class="comment">-- 先求出活 80 岁 时, 是什么日期 X</span></span><br><span class="line"><span class="comment">-- 然后在使用 datediff(x, now()); 1986-11-11-&gt;datetime</span></span><br><span class="line"><span class="comment">-- INTERVAL 80 YEAR ： YEAR 可以是 年月日，时分秒</span></span><br><span class="line"><span class="comment">-- &#x27;1986-11-11&#x27; 可以 date,datetime timestamp</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(DATE_ADD(<span class="string">&#x27;1986-11-11&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">80</span> <span class="keyword">YEAR</span>), NOW()) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">SELECT</span> TIMEDIFF(<span class="string">&#x27;10:11:11&#x27;</span>, <span class="string">&#x27;06:10:10&#x27;</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- FROM_UNIXTIME() : 可以把一个 unix_timestamp 秒数[时间戳]，转成指定格式的日期</span></span><br><span class="line"><span class="comment">-- %Y-%m-%d 格式是规定好的，表示年月日</span></span><br><span class="line"><span class="comment">-- 意义：在开发中，可以存放一个整数，然后表示时间，通过 FROM_UNIXTIME 转换</span></span><br><span class="line"><span class="keyword">SELECT</span> FROM_UNIXTIME(<span class="number">1618483484</span>, <span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">SELECT</span> FROM_UNIXTIME(<span class="number">1618483100</span>, <span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>



<h2 id="加密函数"><a href="#加密函数" class="headerlink" title="加密函数"></a>加密函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">user</span>() 查询用户，可以查看登录到mysql的有哪些用户，以及登录的IP</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>() <span class="keyword">FROM</span> DUAL;</span><br><span class="line">#database()查询当前使用的数据库名称</span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"># MD5(str) 为字符串算出一个MD5(<span class="number">32</span>位)字符串，常用于(用户密码)加密</span><br><span class="line"># 在数据库中存放的应该是加密后的密码</span><br><span class="line"><span class="keyword">SELECT</span> MD5(<span class="string">&#x27;zzc&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"># SHA(STR),根据密码str计算并返回加密后的密码字符串，当参数为<span class="keyword">NULL</span>时，返回<span class="keyword">NULL</span>;</span><br><span class="line"># SHA加密算法比MD5更加安全 。</span><br><span class="line"><span class="keyword">SELECT</span> SHA(<span class="string">&#x27;zzc&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"># password(str)根据密码str计算并返回密码字符串，常用于数据库的用户密码加密</span><br><span class="line"><span class="keyword">SELECT</span> PASSWORD(<span class="string">&#x27;zzc&#x27;</span>) <span class="keyword">FROM</span> DUAL</span><br><span class="line"></span><br><span class="line"># encode(v,p):返回使用password_seed作为加密密码 加密<span class="keyword">value</span></span><br><span class="line">ENCODE(<span class="keyword">value</span>,password_seed) </span><br><span class="line">#返回使用password_seed作为加密密码 解密<span class="keyword">value</span></span><br><span class="line">DECODE(<span class="keyword">value</span>,password_seed) 返回使用password_seed作为加密密码解密<span class="keyword">value</span></span><br></pre></td></tr></table></figure>



<h2 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># IF(expr1,expr2,expr3) 如果 expr1 为 <span class="literal">True</span> ,则返回 expr2 否则返回 expr3</span><br><span class="line"><span class="keyword">SELECT</span> IF(<span class="literal">TRUE</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"># IFNULL(expr1,expr2) 如果expr1不为空,返回expr1, 否则返回expr2</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL( <span class="keyword">NULL</span>, <span class="string">&#x27;mysql学习&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"># <span class="keyword">case</span> <span class="keyword">when</span> 条件<span class="number">1</span> <span class="keyword">then</span> 结果<span class="number">1</span> <span class="keyword">when</span> 条件<span class="number">2</span> <span class="keyword">then</span> 结果<span class="number">2</span> <span class="keyword">else</span> 结果<span class="number">3</span> <span class="keyword">end</span>; [类似多重分支.]</span><br><span class="line"># 类似: if...else if...else..</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> job <span class="operator">=</span> <span class="string">&#x27;CLERK&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;职员&#x27;</span></span><br><span class="line">   	<span class="keyword">WHEN</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;经理&#x27;</span> 		</span><br><span class="line">    <span class="keyword">WHEN</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;销售人员&#x27;</span> 	  </span><br><span class="line">    <span class="keyword">ELSE</span> job <span class="keyword">END</span></span><br><span class="line">	</span><br><span class="line"># <span class="keyword">case</span> expr <span class="keyword">when</span> 常量<span class="number">1</span> <span class="keyword">then</span> 值<span class="number">1</span> <span class="keyword">when</span> 常量<span class="number">2</span> <span class="keyword">then</span> 值<span class="number">2</span> <span class="keyword">else</span> 值<span class="number">3</span> <span class="keyword">end</span>; </span><br><span class="line"># 类似: switch...case...</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> x</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;我是1&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;我是2&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;你是谁&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FORMAT(<span class="keyword">value</span>,n) <span class="comment">-- 返回对数字value进行格式化后的结果数据。n表示 四舍五入 后保留到小数点后n位</span></span><br><span class="line">CONV(<span class="keyword">value</span>,<span class="keyword">from</span>,<span class="keyword">to</span>) <span class="comment">-- 将value的值进行不同进制之间的转换</span></span><br><span class="line">INET_ATON(ipvalue) <span class="comment">-- inet_aton(i): 将以点分隔的IP地址转化为一个数字</span></span><br><span class="line">INET_NTOA(<span class="keyword">value</span>) <span class="comment">-- inet_ntoa(v): 将数字形式的IP地址转化为以点分隔的IP地址</span></span><br><span class="line">BENCHMARK(n,expr) <span class="comment">-- benchmark(n,e): 将表达式expr重复执行n次。用于测试MySQL处理expr表达式所耗费的时间</span></span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="keyword">value</span> <span class="keyword">USING</span> char_code) <span class="comment">-- 将value所使用的字符编码修改为char_code</span></span><br></pre></td></tr></table></figure>





<h1 id="存储过程和存储函数"><a href="#存储过程和存储函数" class="headerlink" title="存储过程和存储函数"></a>存储过程和存储函数</h1><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>存储过程 就是将一组经过预先编译的SQL语句封装。</p>
<p>执行流程：存储过程预先存储在mysql服务器上，用户需要的时候，只需要向服务器发出调用存储过程的命令，就像调用一个封装的方法一样，之后服务器就可以把预先存储好的这一系列SQL语句全部执行。</p>
<p>好处：</p>
<ul>
<li>简化操作，提高sql语言的重用性；</li>
<li>减少失误；</li>
<li>减少网络传输量，用户只需使用存储过程的名字即可；</li>
<li>减少sql语句暴露在网络上的风险，也提高数据查询的安全性；</li>
</ul>
<p>不足：</p>
<ul>
<li><p>可移植性差：</p>
<p>存储过程程不能跨数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过程，在换成其他数据库时都需要重新编写。</p>
</li>
<li><p>调试困难：</p>
<p>只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容 易。</p>
</li>
<li><p>版本管理困难：</p>
<p>比如数据表索引发生变化了，可能会导致存储过程失效。在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</p>
</li>
<li><p>不适合高并发：</p>
<p>高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护，增加数据库的压力，显然就 不适用了。</p>
</li>
</ul>
<p>分类：</p>
<p>存储过程的参数有：IN，OUT，INOUT</p>
<ul>
<li>没有参数（无参数无返回）</li>
<li>仅带IN（有参数无返回）</li>
<li>仅带OUT（无参数有返回）</li>
<li>带IN，OUT（有参数有返回）</li>
<li>带INOUT（有参数有返回）</li>
</ul>
<blockquote>
<p>注：IN、OUT、INOUT 都可以在一个存储过程中带多个。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 创建 </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名 (<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span> 参数名 参数类型, ....) </span><br><span class="line">[charcateristics...]</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	存储过程体</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line"><span class="keyword">call</span> 存储过程名(实参列表)</span><br><span class="line"># 调用<span class="keyword">in</span>模式的参数</span><br><span class="line"><span class="keyword">CALL</span> sp1(<span class="string">&#x27;值&#x27;</span>);</span><br><span class="line"># 调用<span class="keyword">out</span>模式的参数</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@name</span>;</span><br><span class="line"><span class="keyword">CALL</span> SPQ(<span class="variable">@name</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span>;</span><br><span class="line">#调用<span class="keyword">inout</span>模式的参数</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@name</span><span class="operator">=</span>值;</span><br><span class="line"><span class="keyword">CALL</span> sp1(<span class="variable">@name</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span>;</span><br></pre></td></tr></table></figure>

<p>因为mysql默认的语句结束符号为分号 ‘；‘，为了避免与存储过程的sql语句冲突，需要使用delimiter改变存储过程的结束符；</p>
<blockquote>
<p>如果使用的Navicat工具，那么在编写存储过程时，Navicat会自动设置 DELIMITER ，不需要自己再额外设置了。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名(<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span> 参数名 参数类型,...)</span><br><span class="line">[characteristics ...]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">sql</span>语句<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">sql</span>语句<span class="number">2</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>IN：当前函数为输入参数；存储过程只是读取这个参数的值。没有定义参数种类时，默认为IN；</p>
<p>OUT：当前参数为输出参数；执行完毕后，执行调用的客户端可以读取这个这个参数返回的值。</p>
<p>INOUT：当前参数即可为输入参数，也可为输出参数；</p>
<p>characteristics：表示创建存储过程时指定的对存储过程的约束条件，取值如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">language</span> <span class="keyword">sql</span></span><br><span class="line"><span class="operator">|</span> [<span class="keyword">not</span>] <span class="keyword">deterministic</span></span><br><span class="line"><span class="operator">|</span> &#123;<span class="keyword">contains</span> <span class="keyword">sql</span> <span class="operator">|</span> <span class="keyword">no</span> <span class="keyword">sql</span> <span class="operator">|</span> <span class="keyword">reads</span> <span class="keyword">sql</span> data <span class="operator">|</span> <span class="keyword">modifies</span> <span class="keyword">sql</span> data&#125;</span><br><span class="line"><span class="operator">|</span> <span class="keyword">sql</span> security &#123; definer <span class="operator">|</span> invoker &#125;</span><br><span class="line"><span class="operator">|</span> comment <span class="string">&#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>

<p>LANGUAGE SQL ：说明存储过程执行体是由SQL语句组成的，当前系统支持的语言为SQL。</p>
<p>[NOT] DETERMINISTIC ：指明存储过程执行的结果是否确定。DETERMINISTIC表示结果是确定 的。每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为NOT DETERMINISTIC。</p>
<p>{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } ：指明子程序使 用SQL语句的限制。</p>
<ul>
<li>CONTAINS SQL表示当前存储过程的子程序包含SQL语句，但是并不包含读写数据的SQL语句； </li>
<li>NO SQL表示当前存储过程的子程序中不包含任何SQL语句； </li>
<li>READS SQL DATA表示当前存储过程的子程序中包含读数据的SQL语句； </li>
<li>MODIFIES SQL DATA表示当前存储过程的子程序中包含写数据的SQL语句。 </li>
<li>默认情况下，系统会指定为CONTAINS SQL。</li>
</ul>
<p>SQL SECURITY { DEFINER | INVOKER } ：执行当前存储过程的权限，即指明哪些用户能够执 行当前存储过程。</p>
<ul>
<li>DEFINER 表示只有当前存储过程的创建者或者定义者才能执行当前存储过程； </li>
<li>INVOKER 表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。 </li>
<li>如果没有设置相关的值，则MySQL默认指定值为DEFINER。</li>
</ul>
<p>COMMENT ‘string’ ：注释信息，可以用来描述存储过程。</p>
</blockquote>
<h2 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h2><p>mysql允许自定义函数，调用方式与调用mysql的系统函数一样。</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> 函数名(参数名 参数类型, ...)</span><br><span class="line"><span class="keyword">returns</span> 返回值类型</span><br><span class="line">[characteristics ...]</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	函数体</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"># <span class="keyword">returns</span>对函数而言是强制的，函数体必须包含一个<span class="keyword">RETURN</span> <span class="keyword">value</span>语句；</span><br><span class="line"># characteristic是创建函数时指定的对函数的约束。取值与创建存储过程时相同。</span><br></pre></td></tr></table></figure>

<p>调用：与调用mysql内部函数是一样的 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 函数名(实参列表)</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<p>创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，数据类型 为整型。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> count_by_id(dept_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line">	<span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line">	<span class="keyword">NOT</span> <span class="keyword">DETERMINISTIC</span></span><br><span class="line">	<span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line">	<span class="keyword">SQL</span> SECURITY DEFINER</span><br><span class="line">	COMMENT <span class="string">&#x27;查询部门平均工资&#x27;</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id <span class="operator">=</span> dept_id);</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@dept</span>_id <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"><span class="keyword">SELECT</span> count_by_id(<span class="variable">@dept</span>_id);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th></th>
<th>关键字</th>
<th>调用语法</th>
<th>返回值</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>存储过程</td>
<td>procedure</td>
<td>call 存储过程()</td>
<td>0个或多个</td>
<td>一般用于更新</td>
</tr>
<tr>
<td>存储函数</td>
<td>function</td>
<td>select 函数()</td>
<td>只能一个</td>
<td>一般用于查询结果为一个值并返回时</td>
</tr>
</tbody></table>
<p><strong>查看存储过程和存储函数的</strong></p>
<p><strong>创建信息：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> &#123;<span class="keyword">procedure</span> <span class="operator">|</span> <span class="keyword">function</span>&#125; 存储过程名或函数名</span><br></pre></td></tr></table></figure>

<p><strong>状态信息：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 返回子程序的特征，如数据库，名字，类型，创建者，创建、修改日期</span><br><span class="line"><span class="keyword">show</span> &#123;<span class="keyword">procedure</span> <span class="operator">|</span> <span class="keyword">function</span>&#125; status [<span class="keyword">like</span> <span class="string">&#x27;pattern&#x27;</span>]</span><br><span class="line"># [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span>] 匹配存储过程或函数的名称，可省略。省略时，列出数据库中存在的所有存储过程和函数的信息。</span><br></pre></td></tr></table></figure>

<p><strong>存储信息：</strong></p>
<p>MySQL中存储过程和函数的信息放在 infornation_schema 数据库下的 Routines 表中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.Routines</span><br><span class="line">	<span class="keyword">WHERE</span> ROUTINE_NAME<span class="operator">=</span><span class="string">&#x27;存储过程或函数名&#x27;</span> [<span class="keyword">AND</span> ROUNTINE_TYPE <span class="operator">=</span> &#123;<span class="string">&#x27;PROCEDURE | FUNCTION&#x27;</span>&#125;];</span><br><span class="line"># 如果存储过程和函数有同名的情况，可以指定routine_type来指明查的是存储过程还是函数。</span><br></pre></td></tr></table></figure>



<p><strong>修改：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; 存储过程或函数的名 [characteristic]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>characteristic指定存储过程或函数的特性，其取值信息与创建存储过程、函数时的取值信息略有不同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="keyword">CONTAINS</span> <span class="keyword">SQL</span> <span class="operator">|</span> <span class="keyword">NO</span> <span class="keyword">SQL</span> <span class="operator">|</span> <span class="keyword">READS</span> <span class="keyword">SQL</span> DATA <span class="operator">|</span> <span class="keyword">MODIFIES</span> <span class="keyword">SQL</span> DATA &#125; </span><br><span class="line"><span class="operator">|</span> <span class="keyword">SQL</span> SECURITY &#123; DEFINER <span class="operator">|</span> INVOKER &#125;</span><br><span class="line"><span class="operator">|</span> COMMENT <span class="string">&#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>

<p>CONTAINS SQL ，表示子程序包含SQL语句，但不包含读或写数据的语句。</p>
<p>NO SQL ，表示子程序中不包含SQL语句。 </p>
<p>READS SQL DATA ，表示子程序中包含读数据的语句。 </p>
<p>MODIFIES SQL DATA ，表示子程序中包含写数据的语句。 </p>
<p>SQL SECURITY { DEFINER | INVOKER } ，指明谁有权限来执行。</p>
<ul>
<li>DEFINER ，表示只有定义者自己才能够执行。</li>
<li>INVOKER ，表示调用者可以执行。</li>
</ul>
<p>COMMENT ‘string’ ，表示注释信息。</p>
</blockquote>
<p><strong>删除：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; [IF <span class="keyword">EXISTS</span>] 存储过程或函数的名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>IF EXISTS：如果程序或函数不存储，它可以防止发生错误，产生一个用SHOW WARNINGS查看的警告。</p>
</blockquote>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>MySQL常用列类型(数据类型)</p>
<ul>
<li>数值类型<ul>
<li>整型：tinyint（1个字节）smallint（2个字节）mediumint（3个字节）<strong>int</strong>（4个字节）bigint（8个字节）decimal[M, 0]（数值长度为M）</li>
<li>小数类型：float（单精度4字节）<strong>double</strong>（双精度8字节）**decimal[M,D]**（数值长度M，小数部分长度D；M最大65，D最大30；M被省略则默认为10，D被省略则默认为0)</li>
</ul>
</li>
<li>文本类型（字符串类型）<ul>
<li><strong>char</strong> （0~255字符，固定长）</li>
<li><strong>varchar</strong> （0<del>65535 即 最大放0</del>2^16 - 1字节，可变长，实际占用空间看存放多少数据，varchar本身需要占用1~3个字节来记录存放内容的长度）<ul>
<li>查询速度：char &gt; varchar</li>
<li>varchar 存放大小的单位写的仍是字符，但存放上下限是按字节算的</li>
</ul>
</li>
<li><strong>text</strong>  （0~ 2^16 - 1）</li>
<li>longtext （0~2^32 - 1）</li>
</ul>
</li>
<li>二进制数据类型<ul>
<li>blob （0~2^16 - 1）</li>
<li>longblob （0~2^32 - 1）</li>
</ul>
</li>
<li>日期类型<ul>
<li>date （日期 年月日   3字节）</li>
<li>time （时间 时分秒   3字节）</li>
<li><strong>datetime</strong> （年月日 时分秒  YYYY-MM-DD HH:mm:ss    8字节）</li>
<li><strong>timestamp</strong> （时间戳，会自动更新   4字节）<ul>
<li>自动更新时间戳为当前时间：login_time（列名） TIMESTAMP（数据类型：时间戳） NOT NULL DEFAULT CURRENT_TIMESTAMP  ON UPDATE CURRENT_TIMESTAMP</li>
</ul>
</li>
<li>year (年   1字节)</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205181016336.png" alt="image-20220518101510416"></p>
<p>常用的类型介绍：</p>
<p><img src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202203211047881.png" alt="image-20220321104728683"></p>
<blockquote>
<p>MySQL在执行建表语句时，将id字段的类型默认设置为int(11)，这里的11是指int类型的显示宽度，默认的显示宽度为11。</p>
</blockquote>
<p>使用建议：</p>
<ul>
<li><p>任何字段如果为非负数，应该加unsigned</p>
</li>
<li><p>整数：int</p>
</li>
<li><p>小数：decimal，如果存储的数据范围超过，建议将数据拆成整数和小数并分开存储。</p>
</li>
<li><p>日期时间：datetime</p>
</li>
<li><p>字符串：</p>
<ul>
<li>如果存储的字符串长度几乎相等，使用char定长字符串类型；</li>
<li>varchar不预先分配存储空间，长度不要超过5000，如果超过，应该定义为text，并独立出来一张表，用主键来对应，避免影响其他字段索引效率。</li>
</ul>
</li>
</ul>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h2><p>变量由系统定义，属于服务器层面。启动MySQL服务，生成MySQL服务实例期间， MySQL将为MySQL服务器内存中的系统变量赋值，这些系统变量定义了当前MySQL服务实例的属性、特征。</p>
<blockquote>
<p>系统变量的值大都是 编译MySQL时参数的默认值，或配置文件(如 .ini)中的参数值。</p>
</blockquote>
<ul>
<li><p><strong>global 全局系统变量</strong>，也简称全局变量</p>
</li>
<li><p><strong>session 会话系统变量</strong>，也可称 local变量，</p>
</li>
</ul>
<blockquote>
<p>如果没有加global关键字，则默认为会话级别。</p>
<p>静态变量属于特殊的全局系统变量。</p>
</blockquote>
<p>每个客户机功连接MySQL服务器后，都会产生与之对应的会话。</p>
<p>会话期间，MySQL服务实例 会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变量值的复制。</p>
<ul>
<li>全局系统变量针对于所有会话（连接）有效，但不能 跨重启 (即重启服务);</li>
<li>修改会话变量仅影响当前的会话&#x2F;连接， 不会影响其他会话的同一会话系统变量的值。</li>
<li>修改全局系统变量的值会导致 同一会话系统的其他会话 的全局系统变量改变。</li>
</ul>
<p>查看系统变量：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有全局变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES;</span><br><span class="line"># 查看所有会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES;</span><br><span class="line"></span><br><span class="line"># 查看满足条件的系统<span class="operator">/</span>会话变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%标识符%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%标识符%&#x27;</span></span><br><span class="line"># 例如:</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;ADMIN_%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查看指定的系统变量的值</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.变量名;</span><br><span class="line"></span><br><span class="line"># 查看指定的会话变量的值</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@session</span>.变量名;</span><br><span class="line"><span class="keyword">SELECT</span> @@变量名;</span><br></pre></td></tr></table></figure>

<p>修改系统变量的值：</p>
<p>方法1：修改MySQL配置文件，继而修改MySQL系统变量的值（需要重启MySQL服务）</p>
<p>方法2：使用 set命令 重新设置系统变量的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#为某个系统变量赋值</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@global</span>.变量名<span class="operator">=</span>变量值;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> 变量名<span class="operator">=</span>变量值;</span><br><span class="line"></span><br><span class="line">#为某个会话变量赋值</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.变量名<span class="operator">=</span>变量值;</span><br><span class="line"><span class="keyword">SET</span> SESSION 变量名<span class="operator">=</span>变量值;</span><br><span class="line"></span><br><span class="line"># 例如：</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.autocommit;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> autocommit<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> max_connections<span class="operator">=</span><span class="number">1000</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.max_connections;</span><br></pre></td></tr></table></figure>

<hr>
<p>MySQL8.0新特性：全局变量的持久化</p>
<p>使用 set global 语句设置的变量值只会 临时生效，数据库重启后又变成默认值。</p>
<p>而使用 set persist 命令，会将该命令的配置保存到数据目录下的musql-auto.cnf文件中，下次数据库重启时会读取该文件，用其中的配置来覆盖默认的配置文件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 例：设服务器最大连接数为1000</span></span><br><span class="line"><span class="keyword">SET</span> PERSIST <span class="keyword">global</span> max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>







<h2 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h2><p>mysql中的用户变量以 一个 @ 开头，分为 会话用户变量和局部变量。</p>
<ul>
<li>会话用户变量：作用域和会话变量一样，只对 当前连接 会话有效。</li>
<li>局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在 存储过程和函数 中使用。</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>作用域</th>
<th>定义位置</th>
<th>语法</th>
</tr>
</thead>
<tbody><tr>
<td>会话用户变量</td>
<td>当前会话</td>
<td>会话的任何地方</td>
<td>加@符号，不用指定类型</td>
</tr>
<tr>
<td>局部变量</td>
<td>定义它的begin end中</td>
<td>begin end的第一句话</td>
<td>一般不加@，需指定类型</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 会话用户变量的定义</span><br><span class="line">#方式<span class="number">1</span>：“<span class="operator">=</span>”或“:<span class="operator">=</span>”</span><br><span class="line"><span class="keyword">SET</span> @用户变量 <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">SET</span> @用户变量 :<span class="operator">=</span> 值;</span><br><span class="line"></span><br><span class="line">#方式<span class="number">2</span>：“:<span class="operator">=</span>” 或 <span class="keyword">INTO</span>关键字</span><br><span class="line"><span class="keyword">SELECT</span> @用户变量 :<span class="operator">=</span> 表达式 [<span class="keyword">FROM</span> 等子句];</span><br><span class="line"><span class="keyword">SELECT</span> 表达式 <span class="keyword">INTO</span> @用户变量 [<span class="keyword">FROM</span> 等子句];</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line"><span class="keyword">SELECT</span> @用户变量</span><br><span class="line"></span><br><span class="line"># 例：</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@a</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@a</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@num</span> :<span class="operator">=</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employee;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@num</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">INTO</span> <span class="variable">@avgSalary</span> <span class="keyword">FROM</span> employee;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@avgSalary</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@big</span>;   <span class="comment">-- 查看未声明变量时，得到NULL值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 局部变量 的定义 <span class="keyword">declare</span>只能放在begin...end中的第一句</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	# 声明</span><br><span class="line">	<span class="keyword">DECLARE</span> 变量<span class="number">1</span> 变量数据类型 [<span class="keyword">DEFAULT</span> 变量默认值];  <span class="comment">-- 默认初始值是NULL</span></span><br><span class="line">	<span class="keyword">DECLARE</span> 变量<span class="number">2</span>,变量<span class="number">3</span>,... 变量数据类型 [<span class="keyword">DEFAULT</span> 变量默认值];</span><br><span class="line">	</span><br><span class="line">	# 赋值</span><br><span class="line">	<span class="keyword">SET</span> 变量名<span class="number">1</span> <span class="operator">=</span> 值;</span><br><span class="line">	<span class="keyword">SET</span> 变量名<span class="number">1</span> :<span class="operator">=</span> 值;</span><br><span class="line">	<span class="keyword">SELECT</span> 值 <span class="keyword">INTO</span> 变量名<span class="number">2</span> [<span class="keyword">FROM</span> 子句];</span><br><span class="line">	<span class="keyword">SELECT</span> 字段名或表达式 <span class="keyword">INTO</span> 变量名<span class="number">2</span> <span class="keyword">FROM</span> 表;</span><br><span class="line">	</span><br><span class="line">	# 查看</span><br><span class="line">	<span class="keyword">SELECT</span> 变量<span class="number">1</span>,变量<span class="number">2</span>,变量<span class="number">3</span>;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"># 例：</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> set_value()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> emp_name <span class="type">VARCHAR</span>(<span class="number">25</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> sal <span class="keyword">DOUBLE</span>(<span class="number">10</span>,<span class="number">2</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> last_name,salary <span class="keyword">INTO</span> emp_name,sal</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">102</span>;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">SELECT</span> emp_name,sal;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ; </span><br></pre></td></tr></table></figure>





<h1 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h1><p><strong>定义条件</strong>：事先定义程序执行过程中可能遇到的问题；</p>
<p><strong>处理程序</strong>：定义了在遇到问题时应当采取的处理方式，并且保证存储过程或函数在遇到警告或错误时能继续执行。——增强了处理问题的能力，避免程序异常停止运行。</p>
<blockquote>
<p>定义条件和处理程序在存储过程、存储函数中都是支持的。</p>
</blockquote>
<p>在存储过程中未定义条件和处理程序，且当存储过程中执行的SQL语句报错时，MySQL数据库会抛出错误，并退出当前SQL逻辑， 不再向下继续执行。</p>
<h3 id="定义条件"><a href="#定义条件" class="headerlink" title="定义条件"></a>定义条件</h3><p>定义条件就是给MySQL中的错误码 命名，它将一个错误名字和指定的错误条件关联起来。这个名字随后被用在定义处理程序的 declare handler 语句中。</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 错误名称 <span class="keyword">condition</span> <span class="keyword">for</span> 错误码(或错误条件)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>错误码的说明：</p>
<p>MySQL_error_code 和 sqlstate_value 都可以表示MySQL的错误。</p>
<ul>
<li>MySQL_error_code是数值类型错误代码。 </li>
<li>sqlstate_value是长度为5的字符串类型错误代码。</li>
</ul>
<p>例如：</p>
<p>在ERROR 1418 (HY000)中，1418是MySQL_error_code，’HY000’是sqlstate_value。 </p>
<p>在ERROR 1142（42000）中，1142是MySQL_error_code，’42000’是sqlstate_value。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 例: 给违反非空约束的错误类型“ERROR <span class="number">1048</span>(<span class="number">23000</span>)”定义</span><br><span class="line">#使用MySQL_error_code</span><br><span class="line"><span class="keyword">DECLARE</span> Field_Not_Be_NULL <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="number">1048</span>;</span><br><span class="line">#使用sqlstate_value</span><br><span class="line"><span class="keyword">DECLARE</span> Field_Not_Be_NULL <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;23000&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="定义处理程序"><a href="#定义处理程序" class="headerlink" title="定义处理程序"></a>定义处理程序</h3><p>为SQL执行过程中发生的某种类型的错误定义特殊的处理程序。</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 处理方式 HANDLER <span class="keyword">FOR</span> 错误类型 处理语句</span><br></pre></td></tr></table></figure>

<p>处理方式有三种：continue，exit，undo</p>
<ul>
<li>CONTINUE：遇到错误不处理，继续执行；</li>
<li>EXIT：遇到错误马上退出；</li>
<li>UNDO：遇到错误后撤回之前的操作，MySQL中暂时不支持。</li>
</ul>
<p>错误类型：</p>
<ul>
<li>SQLSTATE ‘字符串错误码’ ：表示长度为5的sqlstate_value类型的错误代码； </li>
<li>MySQL_error_code ：匹配数值类型错误代码； </li>
<li>错误名称 ：表示DECLARE … CONDITION定义的错误条件名称。 </li>
<li>SQLWARNING ：匹配所有以01开头的SQLSTATE错误代码； </li>
<li>NOT FOUND ：匹配所有以02开头的SQLSTATE错误代码； </li>
<li>SQLEXCEPTION ：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码；</li>
</ul>
<p>处理语句：可以是“set 变量 &#x3D; 值”这样简单的语句，也可以是使用“begin….end”的复合语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 定义处理程序的几种方式举例：</span><br><span class="line">#方法<span class="number">1</span>：捕获sqlstate_value</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;42S02&#x27;</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#方法<span class="number">2</span>：捕获mysql_error_value</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="number">1146</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#方法<span class="number">3</span>：先定义条件，再调用</span><br><span class="line"><span class="keyword">DECLARE</span> no_such_table <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="number">1146</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> NO_SUCH_TABLE <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#方法<span class="number">4</span>：使用<span class="keyword">SQLWARNING</span></span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLWARNING</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;ERROR&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#方法<span class="number">5</span>：使用<span class="keyword">NOT</span> FOUND</span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#方法<span class="number">6</span>：使用<span class="keyword">SQLEXCEPTION</span></span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;ERROR&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p>创建一个名称为“InsertDataWithCondition”的存储过程：在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到sqlstate_value值为23000（重复条目错误）时，执行EXIT操 作，并且将@proc_value的值设置为-1。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> InsertDataWithCondition()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> duplicate_entry <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;23000&#x27;</span> ;</span><br><span class="line">	<span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> duplicate_entry <span class="keyword">SET</span> <span class="variable">@proc</span>_value <span class="operator">=</span> <span class="number">-1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments(department_name) <span class="keyword">VALUES</span>(<span class="string">&#x27;测试&#x27;</span>);</span><br><span class="line">	<span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments(department_name) <span class="keyword">VALUES</span>(<span class="string">&#x27;测试&#x27;</span>);</span><br><span class="line">	<span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>







<h1 id="流程控制与游标"><a href="#流程控制与游标" class="headerlink" title="流程控制与游标"></a>流程控制与游标</h1><p>流程控制：控制存储过程中sql语句的执行顺序。分别有三大类：顺序结构，分支结构，循环结构。</p>
<p>流程控制语句（只能用于存储程序）：</p>
<ul>
<li>条件判断语句：if 和 case语句</li>
<li>循环语句：loop，while，repeat语句</li>
<li>跳转语句：iterate 和 leave语句</li>
</ul>
<p><strong>分支结构—— IF</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># if</span><br><span class="line">IF 表达式<span class="number">1</span> <span class="keyword">THEN</span> 操作<span class="number">1</span>;</span><br><span class="line">[ELSEIF 表达式<span class="number">2</span> <span class="keyword">THEN</span> 操作<span class="number">2</span>;]....</span><br><span class="line">[<span class="keyword">ELSE</span> 操作n;]</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"># 例：</span><br><span class="line">IF val <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line">	<span class="keyword">THEN</span> <span class="keyword">SELECT</span> <span class="string">&#x27;val is null&#x27;</span>;</span><br><span class="line"><span class="keyword">ELSE</span> <span class="keyword">SELECT</span> <span class="string">&#x27;val is not null&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> update_salary_by_eid2(<span class="keyword">IN</span> emp_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> emp_salary <span class="keyword">DOUBLE</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> hire_year <span class="keyword">DOUBLE</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> emp_salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> emp_id;</span><br><span class="line">	<span class="keyword">SELECT</span> DATEDIFF(CURDATE(),hire_date)<span class="operator">/</span><span class="number">365</span> <span class="keyword">INTO</span> hire_year <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> emp_id;	<span class="comment">-- DATEDIFF()判断日期差，curdate()获取当前日期</span></span><br><span class="line">	IF emp_salary <span class="operator">&lt;</span> <span class="number">8000</span> <span class="keyword">AND</span> hire_year <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line">		<span class="keyword">THEN</span> <span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span> <span class="keyword">WHERE</span> employee_id <span class="operator">=</span></span><br><span class="line">emp_id;</span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		<span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> emp_id;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p><strong>分支结构——CASE</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">case</span></span><br><span class="line"># <span class="number">1.</span>类似于switch</span><br><span class="line"><span class="keyword">CASE</span> 表达式</span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">1</span> <span class="keyword">THEN</span> 结果<span class="number">1</span>或语句<span class="number">1</span> <span class="comment">-- 如果是语句，需要加分号</span></span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">2</span> <span class="keyword">THEN</span> 结果<span class="number">2</span>或语句<span class="number">2</span> <span class="comment">-- 如果是语句，需要加分号</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">ELSE</span> 结果n或语句n <span class="comment">-- 如果是语句，需要加分号</span></span><br><span class="line"><span class="keyword">END</span> [<span class="keyword">case</span>] <span class="comment">-- 如果是放在begin end中需要加上case，如果放在select后面不需要</span></span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span>类似于多重if</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> 条件<span class="number">1</span> <span class="keyword">THEN</span> 结果<span class="number">1</span>或语句<span class="number">1</span> <span class="comment">-- 如果是语句，需要加分号</span></span><br><span class="line"><span class="keyword">WHEN</span> 条件<span class="number">2</span> <span class="keyword">THEN</span> 结果<span class="number">2</span>或语句<span class="number">2</span> <span class="comment">-- 如果是语句，需要加分号</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">ELSE</span> 结果n或语句n <span class="comment">-- 如果是语句，需要加分号</span></span><br><span class="line"><span class="keyword">END</span> [<span class="keyword">case</span>] <span class="comment">-- 如果是放在begin end中需要加上case，如果放在select后面不需要</span></span><br></pre></td></tr></table></figure>

<p><strong>循环结构——LOOP</strong></p>
<p>LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子句）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[loop_label:] LOOP</span><br><span class="line">	循环执行的语句</span><br><span class="line"><span class="keyword">END</span> LOOP [loop_label]</span><br><span class="line"><span class="comment">-- loop_label表示LOOP语句的标注名称，参数可省略。</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p>涨工资—— 声明存储过程 “update_salary_loop()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为 原来的1.1倍。直到全公司的平均薪资达到12000结束。并统计循环次数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> update_salary_loop(<span class="keyword">OUT</span> num <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> avg_salary <span class="keyword">DOUBLE</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> loop_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">INTO</span> avg_salary <span class="keyword">FROM</span> employees;</span><br><span class="line">	</span><br><span class="line">	label_loop:LOOP</span><br><span class="line">		IF avg_salary <span class="operator">&gt;=</span> <span class="number">12000</span> <span class="keyword">THEN</span> LEAVE label_loop;</span><br><span class="line">		<span class="keyword">END</span> IF;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.1</span>;</span><br><span class="line">		<span class="keyword">SET</span> loop_count <span class="operator">=</span> loop_count <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">INTO</span> avg_salary <span class="keyword">FROM</span> employees;</span><br><span class="line">	<span class="keyword">END</span> LOOP label_loop;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SET</span> num <span class="operator">=</span> loop_count;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p><strong>循环结构——WHILE</strong></p>
<p>WHILE语句创建一个带条件判断的循环过程。WHILE在执行语句执行时，先对指定的表达式进行判断，如 果为真，就执行循环内的语句，否则退出循环。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[while_label:] WHILE 循环条件 DO</span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">END</span> WHILE [while_label];</span><br></pre></td></tr></table></figure>

<p><strong>循环结构——REPEAT</strong></p>
<p>REPEAT语句创建一个带条件判断的循环过程。与WHILE循环不同的是，REPEAT 循环首先会执行一次循环，然后在 UNTIL 中进行表达式的判断，如果满足条件就退出 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[repeat_label:] REPEAT</span><br><span class="line">	循环体</span><br><span class="line">UNTIL 结束循环的条件表达式</span><br><span class="line"><span class="keyword">END</span> REPEAT [repeat_label]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>三种循环的对比：</p>
<ul>
<li><p>都可以省略名称，但如果循环中添加了循环控制语句（LEAVE或ITERATE）则必须添加名称。</p>
</li>
<li><p>LOOP：一般用于实现简单的”死”循环 </p>
<p>WHILE：先判断后执行 </p>
<p>REPEAT：先执行后判断，无条件至少执行一次</p>
</li>
</ul>
</blockquote>
<p><strong>跳转语句——LEAVE</strong></p>
<p>LEAVE语句：可以用在循环语句内，或者以 BEGIN 和 END 包裹起来的程序体内，表示跳出循环或者跳出 程序体的操作。(类似于编程语言的break)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEAVE 标记名</span><br></pre></td></tr></table></figure>

<p><strong>跳转语句——ITERATE</strong></p>
<p>iterate语句只能用在循环语句（LOOP、REPEAT和WHILE语句）内，表示重新开始循环，将执行顺序转到语句段开头处。（类似于编程语言的continue）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ITERATE label</span><br></pre></td></tr></table></figure>



<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>游标提供一种灵活的操作方式，能够对结果集中的每一条记录 进行定位，并对指向的记录中的数据进行操作的数据结构。</p>
<blockquote>
<p>在SQL中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。即<strong>充当了指针的作用</strong>。</p>
<p>游标让 面向集合的SQL语言有了面向过程开发的能力。</p>
</blockquote>
<blockquote>
<p>一些性能问题：</p>
<p>游标可以在存储程序中使用，效率高，程序也更加简洁，比在应用层实现相同的功能要好。</p>
<p>但在使用游标的过程中，会对数据行进行 加锁 ，这样在业务并发量大的时候，不仅会影响业务之间的效率，还会消耗系统资源 ，造成内存不足，这是因为游标是在内存中进 行的处理。</p>
<p>所以要在用完后及时关闭，这样才能提高系统整体效率。</p>
</blockquote>
<p>使用步骤：</p>
<p>游标必须在 声明处理程序之前 被声明，且 变量和条件必须在声明游标&#x2F;处理程序之前 被声明。</p>
<ul>
<li><p>第一步：声明游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 适用于MySQL,<span class="keyword">SQL</span> Server,DB2 和 MariaDB</span><br><span class="line"><span class="keyword">DECLARE</span> 游标名 <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> 查询语句<span class="operator">/</span>结果集</span><br><span class="line"></span><br><span class="line"># 适用于Oricle,PostgreSQL</span><br><span class="line"><span class="keyword">DECLARE</span> 有标明 <span class="keyword">CURSOR</span> <span class="keyword">IS</span> 查询语句<span class="operator">/</span>结果集</span><br></pre></td></tr></table></figure>
</li>
<li><p>第二步：打开游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> 游标名</span><br></pre></td></tr></table></figure>

<p>打开游标时， SELECT 语句的查询结果集就会送到游标工作区，为后面游标的 <u>逐条读取</u> 结果集中的记录做准备。</p>
</li>
<li><p>第三步：使用游标（从游标中取得数据）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FETCH</span> 游标名 <span class="keyword">INTO</span> 变量名[,变量名...]</span><br></pre></td></tr></table></figure>

<p>将游标读取到的行数据 保存到变量名中，然后指针指向下一行。</p>
<blockquote>
<p>查询结果集的字段数，必须与into后的变量数一致。</p>
</blockquote>
</li>
<li><p>第四步：关闭游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CLOSE</span> 游标名</span><br></pre></td></tr></table></figure>

<p>游标会占用系统资源，不关闭的话，会保持到存储过程结束。</p>
</li>
</ul>
<p>示例：</p>
<p>创建存储过程“get_count_by_limit_total_salary()”，声明IN参数 limit_total_salary，DOUBLE类型；声明OUT参数total_count，INT类型。函数的功能可以实现累加薪资最高的几个员工的薪资值，直到薪资总和 达到limit_total_salary参数的值，返回累加的人数给total_count。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_count_by_limit_total_salary(<span class="keyword">IN</span> limit_total_salary <span class="keyword">DOUBLE</span>,<span class="keyword">OUT</span></span><br><span class="line">total_count <span class="type">INT</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> sum_salary <span class="keyword">DOUBLE</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; #记录累加的总工资</span><br><span class="line">	<span class="keyword">DECLARE</span> cursor_salary <span class="keyword">DOUBLE</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; #记录某一个工资值</span><br><span class="line">	<span class="keyword">DECLARE</span> emp_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; #记录循环个数</span><br><span class="line">	#定义游标</span><br><span class="line">	<span class="keyword">DECLARE</span> emp_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line">	#打开游标</span><br><span class="line">	<span class="keyword">OPEN</span> emp_cursor;</span><br><span class="line">	</span><br><span class="line">	REPEAT</span><br><span class="line">		#使用游标（从游标中获取数据）</span><br><span class="line">		<span class="keyword">FETCH</span> emp_cursor <span class="keyword">INTO</span> cursor_salary;</span><br><span class="line">		<span class="keyword">SET</span> sum_salary <span class="operator">=</span> sum_salary <span class="operator">+</span> cursor_salary;</span><br><span class="line">		<span class="keyword">SET</span> emp_count <span class="operator">=</span> emp_count <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">		UNTIL sum_salary <span class="operator">&gt;=</span> limit_total_salary</span><br><span class="line">	<span class="keyword">END</span> REPEAT;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SET</span> total_count <span class="operator">=</span> emp_count;</span><br><span class="line">	#关闭游标</span><br><span class="line">	<span class="keyword">CLOSE</span> emp_cursor;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>



<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><p>触发器是由事件 来触发某个操作，这些事件包括 INSERT 、 UPDATE 、 DELETE 事件。</p>
<p>如果定义了触发程序，当数据库执行这些语句时候，就相当于事件发生 了，就会 自动 激发触发器执行相应的操作。</p>
<p>当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来 实现。</p>
<p>优点：</p>
<ul>
<li>可以确保数据的完整性；—— 比如一张表的修改会影响其他表的数据，则使用触发器就可以同步多个表了。</li>
<li>可以记录操作日志；—— 利用触发器，可以具体记录什么时间发生了什么。</li>
<li>操作数据前对数据进行合法性检查；</li>
</ul>
<p>缺点：</p>
<ul>
<li>可读性差；—— 因为 触发器存储在数据库中，且由事件驱动，这意味着触发器可以不受应用层的控制。使得触发器发生错误时可能难以发现。</li>
<li>相关数据的变更，可能导致触发器出错；—— 特别是表结构的变更，都可能导致触发器的出错。</li>
</ul>
<p><strong>创建：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名称</span><br><span class="line">&#123;BEFORE<span class="operator">|</span>AFTER&#125; &#123;<span class="keyword">INSERT</span><span class="operator">|</span><span class="keyword">UPDATE</span><span class="operator">|</span><span class="keyword">DELETE</span>&#125; <span class="keyword">ON</span> 表名</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line">触发器执行的语句快;</span><br><span class="line"> <span class="comment">-- 表名：是触发器监控的对象;  </span></span><br><span class="line"> <span class="comment">-- before|after:触发的事件，before指在事件之前触发，after指在事件之后触发</span></span><br><span class="line"> <span class="comment">-- INSERT|UPDATE|DELETE ：表示触发的事件。</span></span><br><span class="line"> 	<span class="comment">-- INSERT 表示插入记录时触发；</span></span><br><span class="line">	<span class="comment">-- UPDATE 表示更新记录时触发；</span></span><br><span class="line"> 	<span class="comment">-- DELETE 表示删除记录时触发。 </span></span><br><span class="line"> <span class="comment">-- 触发器执行的语句块：可以是单条SQL语句，也可以是由BEGIN…END结构组成的复合语句块。</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p>定义触发器“salary_check_trigger”，基于员表“employees”的INSERT事件，在INSERT之前检查 将要添加的新员工薪资是否大于他领导的薪资，如果大于领导薪资，则报sqlstate_value为’HY000’的错 误，从而使得添加失败。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> salary_check_trigger</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> employees <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> mgrsalary <span class="keyword">DOUBLE</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> mgrsalary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> NEW.manager_id;</span><br><span class="line">	</span><br><span class="line">	IF NEW.salary <span class="operator">&gt;</span> mgrsalary <span class="keyword">THEN</span></span><br><span class="line">		SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;HY000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;薪资高于领导薪资错误&#x27;</span>;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在触发器的执行语句块中，可以使用 NEW. 指代被监听的表发生添加或修改的那条记录；</p>
<p>要自定义错误，则使用以下格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;HY000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;...&#x27;</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>查看：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语句结尾不加；加\G，数据显示较清晰直观，但SQLyog不识别</span></span><br><span class="line"># 查看当前数据库的所有触发器的定义</span><br><span class="line"><span class="keyword">SHOW</span> TRIGGERS</span><br><span class="line"></span><br><span class="line"># 查看当前数据库中某个触发器的定义</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名</span><br><span class="line"></span><br><span class="line"># 从系统库information_schema的TRIGGERS表中查询所有触发器的信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.TRIGGERS;</span><br></pre></td></tr></table></figure>

<p><strong>删除：</strong></p>
<p>触发器也是数据库对象，所以也用DROP语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> 触发器名称;</span><br></pre></td></tr></table></figure>









<h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><p>JDBC是java提供的一套用于数据库操作的接口API，不同的数据库厂商会针对这套接口，提供不同实现。</p>
<p>JDBC 为访问不同的数据库提供了统一的接口，为使用者屏蔽了细节问题（JDBC统一和规范了应用程序和数据库的连接，执行SQL语句，并得到返回结果等操作）；</p>
<p>使用JDBC可以连接任何提供了JDBC驱动程序的数据库系。</p>
<h3 id="JDBC程序编写步骤"><a href="#JDBC程序编写步骤" class="headerlink" title="JDBC程序编写步骤"></a>JDBC程序编写步骤</h3><ol>
<li>注册驱动 – 加载Driver类</li>
<li>获取连接 – 得到Connection</li>
<li>执行增删改查 – 发送SQL给mysql执行</li>
<li>释放资源 – 关闭相关连接</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">       <span class="comment">// 前置工作: 在项目下创建一个文件夹比如 libs</span></span><br><span class="line">       <span class="comment">// 将 mysql.jar 拷贝到该目录下，并将其添加为库</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//1. 注册驱动</span></span><br><span class="line">       <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Driver</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2. 得到连接:</span></span><br><span class="line">       <span class="comment">// jdbc:mysql:// 规定好协议，通过jdbc方式连接mysql</span></span><br><span class="line">       <span class="comment">// localhost  指主机，可以是ip地址</span></span><br><span class="line">       <span class="comment">// 3306 表示mysql监听的端口</span></span><br><span class="line">       <span class="comment">// zzc_db02 连接到mysql的哪个数据库</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/zzc_db02&quot;</span>;</span><br><span class="line">       <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">       properties.setProperty(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">       properties.setProperty(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;zzc&quot;</span>);</span><br><span class="line">       <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> driver.connect(url, properties);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3. 执行sql</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from actor where id = 1&quot;</span>;</span><br><span class="line">       <span class="comment">//statement 用于执行静态SQL语句并返回其生成的结果的对象</span></span><br><span class="line">       <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connect.createStatement();</span><br><span class="line">       <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> statement.executeUpdate(sql);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//4. 关闭连接资源</span></span><br><span class="line">       statement.close();</span><br><span class="line">       connect.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<h3 id="获取数据库连接"><a href="#获取数据库连接" class="headerlink" title="获取数据库连接"></a>获取数据库连接</h3><p>获取数据库连接的5种方法，常用方法4，5：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式 1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect01</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Driver</span>(); <span class="comment">//创建 driver 对象</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/hsp_db02&quot;</span>;</span><br><span class="line">    <span class="comment">//将 用户名和密码放入到 Properties 对象</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    <span class="comment">//说明 user 和 password 是规定好，后面的值根据实际情况写</span></span><br><span class="line">    properties.setProperty(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>);<span class="comment">// 用户</span></span><br><span class="line">    properties.setProperty(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;zzc&quot;</span>); <span class="comment">//密码</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> driver.connect(url, properties);</span><br><span class="line">    System.out.println(connect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式 2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect02</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, IllegalAccessException, InstantiationException, SQLException &#123;</span><br><span class="line">    <span class="comment">//使用反射加载 Driver 类 , 动态加载，更加的灵活，减少依赖性</span></span><br><span class="line">    Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> (Driver) aClass.newInstance();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/hsp_db02&quot;</span>;</span><br><span class="line">    <span class="comment">//将 用户名和密码放入到 Properties 对象</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    <span class="comment">//说明 user 和 password 是规定好，后面的值根据实际情况写</span></span><br><span class="line">    properties.setProperty(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>);<span class="comment">// 用户</span></span><br><span class="line">    properties.setProperty(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;zzc&quot;</span>); <span class="comment">//密码</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> driver.connect(url, properties);</span><br><span class="line">    System.out.println(<span class="string">&quot;方式 2=&quot;</span> + connect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式 3 使用 DriverManager 替代 driver 进行统一管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect03</span><span class="params">()</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException, ClassNotFoundException, SQLException &#123;</span><br><span class="line">    <span class="comment">//使用反射加载 Driver</span></span><br><span class="line">    Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> (Driver) aClass.newInstance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建 url 和 user 和 password</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/hsp_db02&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;zzc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册 Driver 驱动</span></span><br><span class="line">    DriverManager.registerDriver(driver);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">    System.out.println(<span class="string">&quot;第三种方式=&quot;</span> + connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式 4: 使用 Class.forName 自动完成注册驱动，简化代码</span></span><br><span class="line"><span class="comment">//这种方式获取连接是使用的最多，推荐使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect04</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException &#123;</span><br><span class="line">    <span class="comment">// 使用反射加载了 Driver 类</span></span><br><span class="line">    <span class="comment">// 在加载 Driver 类时，完成注册</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    源码:</span></span><br><span class="line"><span class="comment">    1. 静态代码块，在类加载时，会执行一次.</span></span><br><span class="line"><span class="comment">    2. DriverManager.registerDriver(new Driver());</span></span><br><span class="line"><span class="comment">    3. 因此注册 driver 的工作已经完成</span></span><br><span class="line"><span class="comment">        static &#123;</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                DriverManager.registerDriver(new Driver());</span></span><br><span class="line"><span class="comment">            &#125; catch (SQLException var1) &#123;</span></span><br><span class="line"><span class="comment">                throw new RuntimeException(&quot;Can&#x27;t register driver!&quot;);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="comment">//创建 url 和 user 和 password</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/hsp_db02&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;zzc&quot;</span>;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">    System.out.println(<span class="string">&quot;第 4 种方式~ &quot;</span> + connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式 5 , 在方式 4 的基础上改进，增加配置文件，让连接 mysql 更加灵活</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect05</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, SQLException &#123;</span><br><span class="line">    <span class="comment">//通过 Properties 对象获取配置文件的信息</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\mysql.properties&quot;</span>));</span><br><span class="line">    <span class="comment">//获取相关的值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">    Class.forName(driver);<span class="comment">//建议写上</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">    System.out.println(<span class="string">&quot;方式 5 &quot;</span> + connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="JDBC-API"><a href="#JDBC-API" class="headerlink" title="JDBC API"></a>JDBC API</h3><h4 id="DriverManger"><a href="#DriverManger" class="headerlink" title="DriverManger"></a>DriverManger</h4><p>驱动管理类</p>
<p><strong>getConnection(url, user, pwd)</strong> : 获取到连接</p>
<hr>
<h4 id="Connection-接口"><a href="#Connection-接口" class="headerlink" title="Connection 接口"></a>Connection 接口</h4><p><strong>createStatement()</strong> ：创建Statement对象</p>
<hr>
<h4 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h4><p>Statement对象用于执行静态SQL语句并返回其生成的结果的对象；</p>
<p>但使用Statement存在SQL注入的风险：SQL注入是利用利用某些系统没有对用户输入数据进行充分检查，而在输入数据中注入非法的SQL语句，恶意攻击数据库；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM admin</span><br><span class="line">	WHERE NAME = &#x27;1&#x27; OR&#x27; AND pwd = &#x27;OR &#x27;1&#x27;= &#x27;1&#x27;</span><br><span class="line"># SQL注入例子：万能密码 or &#x27;1&#x27;= &#x27;1</span><br><span class="line"># 后面的 &#x27;1&#x27;=&#x27;1&#x27; 必定为真，且前面都是OR，所以这条语句查询的内容在数据库中没有，但它依然能通过</span><br></pre></td></tr></table></figure>

<p>推荐使用<strong>PreparedStatement取代</strong>Statement，可以防止SQL注入；</p>
<p>方法：</p>
<p><strong>executeUpdate(sql)</strong> ：执行dml语句，返回影响的行数；</p>
<p>**executeQuery(sql)**：执行查询，返回ResultSet对象；</p>
<p>**execute(sql)**：执行任意的sql，返回布尔值；</p>
<p>Statement使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Statement01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">//让用户输入管理员名和密码</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入管理员的名字: &quot;</span>); <span class="comment">//</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">admin_name</span> <span class="operator">=</span> scanner.nextLine(); <span class="comment">//如果希望看到SQL注入，这里需要用 nextLine; 因为用next():当接收到 空格或者 &#x27;就是表示结束</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入管理员的密码: &quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">admin_pwd</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">        <span class="comment">//通过 Properties 对象获取配置文件的信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\mysql.properties&quot;</span>));</span><br><span class="line">        <span class="comment">//获取相关的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        <span class="comment">//1. 注册驱动</span></span><br><span class="line">        Class.forName(driver);<span class="comment">//建议写上</span></span><br><span class="line">        <span class="comment">//2. 得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        <span class="comment">//3. 得到 Statement</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">        <span class="comment">//4. 组织 SqL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select name , pwd from admin where name =&#x27;&quot;</span> </span><br><span class="line">                + admin_name + <span class="string">&quot;&#x27; and pwd = &#x27;&quot;</span> + admin_pwd + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">        <span class="keyword">if</span> (resultSet.next()) &#123; <span class="comment">//如果查询到一条记录，则说明该管理存在</span></span><br><span class="line">            System.out.println(<span class="string">&quot;恭喜， 登录成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;对不起，登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//关闭连接</span></span><br><span class="line">        resultSet.close();</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h4><p>PreparedStatement 执行的SQL语句中的参数用问号(?)来表示；</p>
<p>调用 PreparedStatement 对象的 setXxx() 方法来设置这些参数， .setXxx() 方法有两个参数，第一个参数是SQL语句中的参数的索引（从1开始，第几个问号），第二个参数是设置的 SQL语句中的参数的值；</p>
<p>方法：</p>
<p><strong>executeUpdate(sql)</strong> ：执行dml语句，返回影响的行数；</p>
<p>**executeQuery(sql)**：执行查询，返回ResultSet对象；</p>
<p>**execute(sql)**：执行任意的sql，返回布尔值；</p>
<p>**setXxx(占位符索引，占位符的值)**：将指定位置的参数设置为给定值（解决了SQL注入）</p>
<p>**setObject(占位符索引，占位符的值)**：将指定位置的参数设置为给定的对象</p>
<p>PreparedStatement使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preparedStatement</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="comment">//让用户输入管理员名和密码</span></span><br><span class="line">    System.out.print(<span class="string">&quot;请输入管理员的名字: &quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">admin_name</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">    System.out.print(<span class="string">&quot;请输入管理员的密码: &quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">admin_pwd</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">    <span class="comment">//通过 Properties 对象获取配置文件的信息</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">    properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\mysql.properties&quot;</span>));</span><br><span class="line">    <span class="comment">//获取相关的值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">    <span class="comment">//1. 注册驱动</span></span><br><span class="line">    Class.forName(driver);<span class="comment">//建议写上</span></span><br><span class="line">    <span class="comment">//2. 得到连接</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">    <span class="comment">//3. 得到 PreparedStatement</span></span><br><span class="line">    <span class="comment">//3.1 组织SqL, 其中，Sql语句的 ? 就相当于占位符</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select name , pwd from admin where name =? and pwd = ?&quot;</span>;</span><br><span class="line">    <span class="comment">//3.2 preparedStatement 对象实现了 PreparedStatement 接口的实现类的对象</span></span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line">    <span class="comment">//3.3 给 ? 赋值</span></span><br><span class="line">    preparedStatement.setString(<span class="number">1</span>, admin_name);</span><br><span class="line">    preparedStatement.setString(<span class="number">2</span>, admin_pwd);</span><br><span class="line">    <span class="comment">//4. 执行 select 语句使用 executeQuery</span></span><br><span class="line">    <span class="comment">// 如果执行的是 dml(update, insert ,delete) executeUpdate()</span></span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> preparedStatement.executeQuery(sql);</span><br><span class="line">    <span class="keyword">if</span> (resultSet.next()) &#123;     <span class="comment">//如果查询到一条记录，则说明该管理存在</span></span><br><span class="line">        System.out.println(<span class="string">&quot;恭喜， 登录成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;对不起，登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//关闭连接</span></span><br><span class="line">    resultSet.close();</span><br><span class="line">    preparedStatement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a>ResultSet</h4><p>ResultSet是结果集，表示数据库结果集的数据表，通常通过执行查询数据库的语句生成；</p>
<p>ResultSet对象保持一个光标指向当前的数据行，最初，光标位于第一行之前，next方法将光标移到下一行，且在ResultSet对象中没有更多行时返回false，因此可以在while循环中用来遍历结果集</p>
<p>方法：</p>
<p>**next()**：向下移动一行，如果没有下一行，返回false；</p>
<p>**previous()**：向上移动一行，如果没有上一行，返回false；</p>
<p><strong>getXxx( 列的索引 &#x2F; 列名)</strong> ：返回对应列的值，接收类型是Xxx</p>
<p><strong>getObject(列的索引&#x2F; 列名)</strong> ：返回索引对应的值，接收类型为Object</p>
<p>ResultSet使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ResultSet01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//通过 Properties 对象获取配置文件的信息</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\mysql.properties&quot;</span>));</span><br><span class="line">    <span class="comment">//获取相关的值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">    <span class="comment">//1. 注册驱动</span></span><br><span class="line">    Class.forName(driver);<span class="comment">//建议写上</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 得到连接</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">    <span class="comment">//3. 得到 Statement</span></span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">    <span class="comment">//4. 组织 SqL</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id, name , sex, borndate from actor&quot;</span>;</span><br><span class="line">    <span class="comment">//执行给定的 SQL 语句，该语句返回单个 ResultSet 对象</span></span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">    <span class="comment">//5. 使用 while 取出数据</span></span><br><span class="line">    <span class="keyword">while</span> (resultSet.next()) &#123; <span class="comment">// 让光标向后移动，如果没有更多行，则返回 false</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> resultSet.getInt(<span class="number">1</span>); <span class="comment">//获取该行的第 1 列</span></span><br><span class="line">        <span class="comment">//int id1 = resultSet.getInt(&quot;id&quot;); 通过列名来获取值, 推荐</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> resultSet.getString(<span class="number">2</span>);<span class="comment">//获取该行的第 2 列</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> resultSet.getString(<span class="number">3</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> resultSet.getDate(<span class="number">4</span>);</span><br><span class="line">        System.out.println(id + <span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;\t&quot;</span> + sex + <span class="string">&quot;\t&quot;</span> + date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6. 关闭连接</span></span><br><span class="line">    resultSet.close();</span><br><span class="line">    statement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="JDBCUtils-封装"><a href="#JDBCUtils-封装" class="headerlink" title="JDBCUtils(封装)"></a>JDBCUtils(封装)</h3><p>在jdbc操作中，获取连接和释放资源 是经常使用到的，可以将其封装到  JDBC连接的工具类JDBCUtils中。</p>
<p>JDBCUtils 实现示例 以及 使用 ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JDBCUtils实现实例:</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JDBCUtils</span> &#123;</span><br><span class="line">    <span class="comment">//定义相关的属性(4个), 因为只需要一份，因此，我们做出 static</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user; <span class="comment">//用户名</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password; <span class="comment">//密码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url; <span class="comment">//url</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver; <span class="comment">//驱动名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//在static代码块中进行初始化</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\mysql.properties&quot;</span>));</span><br><span class="line">            <span class="comment">//读取相关的属性值</span></span><br><span class="line">            user = properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            password = properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            url = properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            driver = properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">//在实际开发中，我们可以这样处理</span></span><br><span class="line">            <span class="comment">//1. 将编译异常转成 运行异常</span></span><br><span class="line">            <span class="comment">//2. 调用者 可以选择捕获该异常，也可以选择默认处理该异常，比较方便.</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//连接数据库, 返回 Connection</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//1. 将编译异常转成 运行异常</span></span><br><span class="line">            <span class="comment">//2. 调用者，可以选择捕获该异常，也可以选择默认处理该异常，比较方便.</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭相关资源</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. ResultSet 结果集</span></span><br><span class="line"><span class="comment">    2. Statement 或者 PreparedStatement</span></span><br><span class="line"><span class="comment">    3. Connection</span></span><br><span class="line"><span class="comment">    4. 如果需要关闭资源，就传入对象，否则传入 null</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet set, Statement statement, Connection connection)</span> &#123;</span><br><span class="line">        <span class="comment">//判断是否为 null</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (set != <span class="literal">null</span>) &#123;</span><br><span class="line">                set.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译异常转成运行异常抛出</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用实例:</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JDBCUtils_Use</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//2. 组织一个 sql</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from actor where id = ?&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">set</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//3. 创建 PreparedStatement 对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setInt(<span class="number">1</span>, <span class="number">5</span>);<span class="comment">//给?号赋值</span></span><br><span class="line">            <span class="comment">//执行, 得到结果集</span></span><br><span class="line">            set = preparedStatement.executeQuery();</span><br><span class="line">            <span class="comment">//遍历该结果集</span></span><br><span class="line">            <span class="keyword">while</span> (set.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> set.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> set.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> set.getString(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">borndate</span> <span class="operator">=</span> set.getDate(<span class="string">&quot;borndate&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> set.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">                System.out.println(id + <span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;\t&quot;</span> + sex + <span class="string">&quot;\t&quot;</span> + borndate + <span class="string">&quot;\t&quot;</span> + phone);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭资源</span></span><br><span class="line">            JDBCUtils.close(set, preparedStatement, connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p>使用Druid实现JDBCUtils</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用Druid实现JDBCUtils</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtilsByDruid</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource ds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在静态代码块完成 ds 初始化</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\druid.properties&quot;</span>));</span><br><span class="line">            ds = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编写 getConnection 方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭连接, 注意：在数据库连接池技术中，close不是真的断掉连接，而是把使用的 Connection 对象放回连接池</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet resultSet, Statement statement, Connection connection)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtilsByDruid_USE</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//2. 组织一个 sql</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from actor where id &gt;= ?&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">set</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//3. 创建 PreparedStatement 对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtilsByDruid.getConnection();</span><br><span class="line">            <span class="comment">// System.out.println(connection.getClass());  运行类型 com.alibaba.druid.pool.DruidPooledConnection</span></span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setInt(<span class="number">1</span>, <span class="number">1</span>);<span class="comment">//给问号赋值</span></span><br><span class="line">            <span class="comment">//执行, 得到结果集</span></span><br><span class="line">            set = preparedStatement.executeQuery();</span><br><span class="line">            <span class="comment">//遍历该结果集</span></span><br><span class="line">            <span class="keyword">while</span> (set.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> set.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> set.getString(<span class="string">&quot;name&quot;</span>);<span class="comment">//getName()</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> set.getString(<span class="string">&quot;sex&quot;</span>);<span class="comment">//getSex()</span></span><br><span class="line">                <span class="type">Date</span> <span class="variable">borndate</span> <span class="operator">=</span> set.getDate(<span class="string">&quot;borndate&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> set.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">                System.out.println(id + <span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;\t&quot;</span> + sex + <span class="string">&quot;\t&quot;</span> + borndate + <span class="string">&quot;\t&quot;</span> + phone);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭资源</span></span><br><span class="line">            JDBCUtilsByDruid.close(set, preparedStatement, connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="事务-1"><a href="#事务-1" class="headerlink" title="事务"></a>事务</h3><p>JDBC程序中当一个Connection对象创建时，默认是自动提交事务的（语句执行成功，就会向数据库自动提交，而不能回滚）。</p>
<p>JDBC 使用事务：</p>
<ul>
<li>使用Connection的setAutoCommit (false) 可以取消自动提交事务；</li>
<li>在所有sql语句成功执行后，调用Connection的commit() 方法提交事务；</li>
<li>当其中某个操作失败或出现异常，调用Connection的rollback() 方法回滚事务；</li>
</ul>
<blockquote>
<p>在异常捕获中，可以将 setAutoCommit (false) 方法和 commit() 方法放在try语句块中，将 rollback() 方法放在catch中，当出现异常时，就可以进行回滚</p>
</blockquote>
<h3 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h3><p>当需要成批插入或者更新记录时，可以采用Java的批量更新机制，这一机制允许多条语句一次性提交给数据库批量处理。</p>
<p>JDBC连接MySQL时，如果要使用批处理功能，要在url中加参数： <strong>rewriteBatchedStatements&#x3D;true</strong></p>
<p>批处理往往和PreparedStatement搭配使用，可以减少编译次数，运行次数，提高效率；</p>
<p>方法：</p>
<p>addBatch() ：添加需要批量处理的SQL语句或参数；</p>
<p>executeBatch() ：执行批量处理语句；</p>
<p>clearBatch() ：清空批处理包的语句；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batch</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into admin2 values(null, ?, ?)&quot;</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;    <span class="comment">//5000次执行</span></span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>, <span class="string">&quot;jack&quot;</span> + i);</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>, <span class="string">&quot;666&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //addBatch源码:</span></span><br><span class="line"><span class="comment">        public void addBatch () throws SQLException &#123;</span></span><br><span class="line"><span class="comment">            synchronized (this.checkClosed().getConnectionMutex()) &#123;</span></span><br><span class="line"><span class="comment">                if (this.batchedArgs == null) &#123;</span></span><br><span class="line"><span class="comment">                    this.batchedArgs = new ArrayList();</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                for (int i = 0; i &lt; this.parameterValues.length; ++i) &#123;</span></span><br><span class="line"><span class="comment">                    this.checkAllParametersSet(this.parameterValues[i], this.parameterStreams[i], i);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                this.batchedArgs.add(new PreparedStatement.BatchParams(this.parameterValues, this.parameterStreams, this.isStream, this.streamLengths, this.isNull));</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        preparedStatement.addBatch();</span><br><span class="line">        <span class="comment">//当有 1000 条记录时，再批量执行，并清空批处理包</span></span><br><span class="line">        <span class="keyword">if</span> ((i + <span class="number">1</span>) % <span class="number">1000</span> == <span class="number">0</span>) &#123;<span class="comment">//满 1000 条 sql</span></span><br><span class="line">            preparedStatement.executeBatch();</span><br><span class="line">            preparedStatement.clearBatch();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//关闭连接</span></span><br><span class="line">    JDBCUtils.close(<span class="literal">null</span>, preparedStatement, connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h3 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h3><p>传统的 JDBC数据库使用DriverManager来获取连接的弊端：</p>
<ul>
<li>每次向数据库建立连接都要将Connection加载到内存中，再验证IP地址，用户名和密码(0.05~1s)。</li>
<li>频繁的进行数据库连接操作将占用很多的系统资源，容易造成服务器崩溃。</li>
<li>每一次数据库连接，使用完后都得断开，如果程序出现异常而未能关闭，将导致数据库内存泄漏。</li>
<li>不能控制连接的方式，不能控制创建的连接数量，如果连接过多，会导致内存泄漏，MySQL崩溃。</li>
</ul>
<p>因此有了数据库连接池技术（connection pool）。</p>
<p>JDBC的数据库连接池使用javax.sql.DataSource来表示， DataSource只是一个接口，该接口通常由第三方提供实现；</p>
<ul>
<li><strong>C3P0</strong> 数据库连接池：速度相对较慢，稳定性不错；</li>
<li>DBCP 数据库连接池：速度较C3P0快，但不稳定；</li>
<li>Proxool 数据库连接池：有监控连接池状态的功能，稳定性较C3P0差一些；</li>
<li>BoneCp 数据库连接池：速度快；</li>
<li>**Druid(德鲁伊)**是阿里提供的数据库连接池，集DBCP，C3P0，Proxool有点于一身的数据库连接池；</li>
</ul>
<h4 id="C3P0"><a href="#C3P0" class="headerlink" title="C3P0"></a>C3P0</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式 1： 相关参数，在程序中指定 user, url , password 等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testC3P0_01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1. 创建一个数据源对象</span></span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">comboPooledDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        <span class="comment">//2. 通过配置文件 mysql.properties 获取相关连接的信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\mysql.properties&quot;</span>));</span><br><span class="line">        <span class="comment">//读取相关的属性值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//给数据源 comboPooledDataSource 设置相关的参数</span></span><br><span class="line">        <span class="comment">//注意：连接管理是由 comboPooledDataSource 来管理</span></span><br><span class="line">        comboPooledDataSource.setDriverClass(driver);</span><br><span class="line">        comboPooledDataSource.setJdbcUrl(url);</span><br><span class="line">        comboPooledDataSource.setUser(user);</span><br><span class="line">        comboPooledDataSource.setPassword(password);</span><br><span class="line">        <span class="comment">//设置初始化连接数</span></span><br><span class="line">        comboPooledDataSource.setInitialPoolSize(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//最大连接数</span></span><br><span class="line">        comboPooledDataSource.setMaxPoolSize(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">//测试连接池的效率, 测试对 mysql 5000 次操作</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++) &#123;</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> comboPooledDataSource.getConnection(); <span class="comment">//这个方法就是从 DataSource 接口实现的</span></span><br><span class="line">            <span class="comment">//其他操作略</span></span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;c3p0 5000 连接 mysql 耗时=&quot;</span> + (end - start));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式 使用配置文件模板来完成</span></span><br><span class="line">    <span class="comment">//1. 将 c3p0 提供的 c3p0.config.xml 拷贝到 src 目录下</span></span><br><span class="line">    <span class="comment">//2. 该文件指定了连接数据库和连接池的相关参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testC3P0_02</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">comboPooledDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>(<span class="string">&quot;hsp_edu&quot;</span>);</span><br><span class="line">        <span class="comment">//测试 5000 次连接 mysql</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;开始执行....&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500000</span>; i++) &#123;</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> comboPooledDataSource.getConnection();</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;c3p0 的第二种方式(500000) 耗时=&quot;</span> + (end - start));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>







<h4 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDruid</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">//1. 加入 Druid.jar 包</span></span><br><span class="line">       <span class="comment">//2. 加入 配置文件 druid.properties (将该文件拷贝项目的src目录)</span></span><br><span class="line">       <span class="comment">//3. 创建 Properties 对象, 读取配置文件</span></span><br><span class="line">       <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">       properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src\\druid.properties&quot;</span>));</span><br><span class="line">       <span class="comment">//4. 创建一个指定参数的数据库连接池, Druid 连接池</span></span><br><span class="line">       <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">       <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500000</span>; i++) &#123;</span><br><span class="line">           <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">           <span class="comment">//其他操作</span></span><br><span class="line">           connection.close();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">&quot;druid 连接池 操作 500000 耗时=&quot;</span> + (end - start));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>







<h3 id="DBUtils"><a href="#DBUtils" class="headerlink" title="DBUtils"></a>DBUtils</h3><p>DBUtils是对JDBC的封装，使用dbutils可以极大简化jdbc的编码的工作量。</p>
<p>DBUtils类：</p>
<ul>
<li><strong>QueryRunner</strong>类：该类封装了SQL的执行，是线程安全的。可以实现 增，删，改，查，批处理；</li>
<li><strong>ResultSetHandler</strong>接口：该接口用于处理java.sql.ResultSet，将数据按要求转换为另一种形式；<ul>
<li>ArrayHandler：把结果集中的第一行转成对象数组；</li>
<li>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中；</li>
<li>BeanHandler：把结果集中的第一行数据封装到一个对应的 JavaBean实例中；</li>
<li>BeanListHandler：把结果集中的每一行数据封装到一个对应的 JavaBean实例中，存放到List里；</li>
<li>ColumnListHandler：将结果集中某一列的数据存放到List中；</li>
<li>KeyedHandler(name)：将结果集中的每一行数据都封装到Map里，再把这些map再存到一个map里，其key为指定的key；</li>
<li>MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值；</li>
<li>MapListHandler：将结果集中的每一行数据都封装到一个Map里，再存放到list</li>
</ul>
</li>
</ul>
<p>DBUtils和Druid搭配使用例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DBUtils_USE</span> &#123;</span><br><span class="line">    <span class="comment">//使用 apache-DBUtils 工具类 + druid 完成对表的 crud 操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryMany</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123; <span class="comment">//返回结果是多行的情况</span></span><br><span class="line">        <span class="comment">//1. 得到 连接 (druid)</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtilsByDruid.getConnection();</span><br><span class="line">        <span class="comment">//2. 使用 DBUtils 类和接口 , 先引入 DBUtils 相关的 jar , 加入到本 Project</span></span><br><span class="line">        <span class="comment">//3. 创建 QueryRunner</span></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//4. 就可以执行相关的方法，返回 ArrayList 结果集</span></span><br><span class="line">        <span class="comment">//String sql = &quot;select * from actor where id &gt;= ?&quot;;</span></span><br><span class="line">        <span class="comment">// 注意: sql 语句也可以查询部分列</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select id, name from actor where id &gt;= ?&quot;</span>;</span><br><span class="line">        <span class="comment">//(1) query 方法就是执行 sql 语句，得到 resultset ---封装到 --&gt; ArrayList 集合中</span></span><br><span class="line">        <span class="comment">//(2) 返回集合</span></span><br><span class="line">        <span class="comment">//(3) connection: 连接</span></span><br><span class="line">        <span class="comment">//(4) sql : 执行的 sql 语句</span></span><br><span class="line">        <span class="comment">//(5) new BeanListHandler&lt;&gt;(Actor.class): 在将 resultset -&gt; Actor 对象 -&gt; 封装到 ArrayList</span></span><br><span class="line">        <span class="comment">// 底层使用反射机制 去获取 Actor 类的属性，然后进行封装</span></span><br><span class="line">        <span class="comment">//(6) 1 就是给 sql 语句中的第一个 ? 赋值，可以有多个值，因为此处是可变参数 Object... params</span></span><br><span class="line">        <span class="comment">//(7) PreparedStatment, 以及底层得到的 resultset ,会在 query 中关闭, 所以最后只需关闭连接connection就行</span></span><br><span class="line">        List&lt;Actor&gt; list = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(Actor.class), <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;输出集合的信息&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Actor actor : list) &#123;</span><br><span class="line">            System.out.print(actor);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//演示 apache-dbutils + druid 完成 返回的结果是单行记录(单个对象)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuerySingle</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">//1. 得到 连接 (druid)</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtilsByDruid.getConnection();</span><br><span class="line">        <span class="comment">//2. 使用 DBUtils 类和接口 , 先引入 DBUtils 相关的 jar , 加入到本 Project</span></span><br><span class="line">        <span class="comment">//3. 创建 QueryRunner</span></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//4. 就可以执行相关的方法，返回单个对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from actor where id = ?&quot;</span>;</span><br><span class="line">        <span class="comment">// 因为我们返回的单行记录&lt;---&gt;单个对象 , 使用的 Hander 是 BeanHandler</span></span><br><span class="line">        <span class="type">Actor</span> <span class="variable">actor</span> <span class="operator">=</span> queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(Actor.class), <span class="number">10</span>);</span><br><span class="line">        System.out.println(actor);</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//演示 apache-dbutils + druid 完成查询结果是单行单列-返回的就是 object</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testScalar</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">//1. 得到 连接 (druid)</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtilsByDruid.getConnection();</span><br><span class="line">        <span class="comment">//2. 使用 DBUtils 类和接口 , 先引入 DBUtils 相关的 jar , 加入到本 Project</span></span><br><span class="line">        <span class="comment">//3. 创建 QueryRunner</span></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//4. 就可以执行相关的方法，返回单行单列 , 返回的就是 Object</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select name from actor where id = ?&quot;</span>;</span><br><span class="line">        <span class="comment">// 因为返回的是一个对象, 使用的 handler 就是 ScalarHandler</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">ScalarHandler</span>(), <span class="number">4</span>);</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//演示 apache-dbutils + druid 完成 dml (update, insert ,delete)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDML</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">//1. 得到 连接 (druid)</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtilsByDruid.getConnection();</span><br><span class="line">        <span class="comment">//3. 创建 QueryRunner</span></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//4. 这里组织 sql 完成 update, insert delete</span></span><br><span class="line">        <span class="comment">//String sql = &quot;update actor set name = ? where id = ?&quot;;</span></span><br><span class="line">        <span class="comment">//String sql = &quot;insert into actor values(null, ?, ?, ?, ?)&quot;;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from actor where id = ?&quot;</span>;</span><br><span class="line">        <span class="comment">//(1) 执行 dml 操作是 queryRunner.update()</span></span><br><span class="line">        <span class="comment">//(2) 返回的值是受影响的行数 (affected: 受影响)</span></span><br><span class="line">        <span class="comment">//int affectedRow = queryRunner.update(connection, sql, &quot;林青霞&quot;, &quot;116&quot;);</span></span><br><span class="line">        <span class="comment">//int affectedRow = queryRunner.update(connection, sql, &quot;林青霞&quot;, &quot;女&quot;, &quot;1966-10-10&quot;, &quot;116&quot;);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">affectedRow</span> <span class="operator">=</span> queryRunner.update(connection, sql, <span class="number">1000</span>);</span><br><span class="line">        System.out.println(affectedRow &gt; <span class="number">0</span> ? <span class="string">&quot;执行成功&quot;</span> : <span class="string">&quot;执行没有影响到表&quot;</span>);</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>











<h3 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h3><p>DAO：data access object 数据访问对象</p>
<p>这样的通用类，称为BasicDao，是专门和数据库交互的，即完成对数据库(表)的crud操作；</p>
<p>编写DAO的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BasicDAO</span>&lt;T&gt; &#123; <span class="comment">//泛型指定具体类型</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">qr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开发通用的 dml 方法, 针对任意的表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object... parameters)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtilsByDruid.getConnection();</span><br><span class="line">            <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> qr.update(connection, sql, parameters);</span><br><span class="line">            <span class="keyword">return</span> update;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e); <span class="comment">//将编译异常-&gt;运行异常 ,抛出</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回多个对象(即查询的结果是多行), 针对任意表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">queryMulti</span><span class="params">(String sql, Class&lt;T&gt; clazz, Object... parameters)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtilsByDruid.getConnection();</span><br><span class="line">            <span class="keyword">return</span> qr.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;T&gt;(clazz), parameters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e); <span class="comment">//将编译异常-&gt;运行异常 ,抛出</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询单行结果 的通用方法</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">querySingle</span><span class="params">(String sql, Class&lt;T&gt; clazz, Object... parameters)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtilsByDruid.getConnection();</span><br><span class="line">            <span class="keyword">return</span> qr.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;T&gt;(clazz), parameters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e); <span class="comment">//将编译异常-&gt;运行异常 ,抛出</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询单行单列的方法,即返回单值的方法</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">queryScalar</span><span class="params">(String sql, Object... parameters)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtilsByDruid.getConnection();</span><br><span class="line">            <span class="keyword">return</span> qr.query(connection, sql, <span class="keyword">new</span> <span class="title class_">ScalarHandler</span>(), parameters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e); <span class="comment">//将编译异常-&gt;运行异常 ,抛出</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtilsByDruid.close(<span class="literal">null</span>, <span class="literal">null</span>, connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ActorDAO</span> <span class="keyword">extends</span> <span class="title class_">BasicDAO</span>&lt;Actor&gt; &#123;</span><br><span class="line">    <span class="comment">// 根据业务需求，可以编写特有的方法. </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDAO</span> &#123;</span><br><span class="line">        <span class="comment">//测试 ActorDAO 对 actor 表 crud 操作</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testActorDAO</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">ActorDAO</span> <span class="variable">actorDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActorDAO</span>();</span><br><span class="line">            <span class="comment">//1. 查询</span></span><br><span class="line">            List&lt;Actor&gt; actors = actorDAO.queryMulti(<span class="string">&quot;select * from actor where id &gt;= ?&quot;</span>, Actor.class, <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;===查询结果===&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Actor actor : actors) &#123;</span><br><span class="line">                System.out.println(actor);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2. 查询单行记录</span></span><br><span class="line">            <span class="type">Actor</span> <span class="variable">actor</span> <span class="operator">=</span> actorDAO.querySingle(<span class="string">&quot;select * from actor where id = ?&quot;</span>, Actor.class, <span class="number">6</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;====查询单行结果====&quot;</span>);</span><br><span class="line">            System.out.println(actor);</span><br><span class="line">            <span class="comment">//3. 查询单行单列</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> actorDAO.queryScalar(<span class="string">&quot;select name from actor where id = ?&quot;</span>, <span class="number">6</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;====查询单行单列值===&quot;</span>);</span><br><span class="line">            System.out.println(o);</span><br><span class="line">            <span class="comment">//4. dml 操作 insert ,update, delete</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> actorDAO.update(<span class="string">&quot;insert into actor values(null, ?, ?, ?, ?)&quot;</span>, <span class="string">&quot;张无忌&quot;</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;2000-11-11&quot;</span>, <span class="string">&quot;999&quot;</span>);</span><br><span class="line">            System.out.println(update &gt; <span class="number">0</span> ? <span class="string">&quot;执行成功&quot;</span> : <span class="string">&quot;执行没有影响表&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><h2 id="MySQL的数据目录"><a href="#MySQL的数据目录" class="headerlink" title="MySQL的数据目录"></a>MySQL的数据目录</h2><p>MySQL数据库文件的存放路径：&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;</p>
<p>相关命令目录：&#x2F;usr&#x2F;bin 和 &#x2F;usr&#x2F;sbin。</p>
<p>配置文件目录：&#x2F;usr&#x2F;share&#x2F;mysql-8.0（命令及配置文件），&#x2F;etc&#x2F;mysql（如my.cnf）</p>
<hr>
<p><strong>数据库和文件系统的关系：</strong></p>
<p>MySQL有4个自带的系统数据库：mysql，information_schema，performance_schema，sys</p>
<ul>
<li><p><strong>mysql</strong></p>
<p>MySQL 系统自带的核心数据库，它存储了MySQL的用户账户和权限信息，一些存储过程、事件的定义信息，一些运行过程中产生的日志信息，一些帮助信息以及时区信息等。</p>
</li>
<li><p><strong>information_schema</strong></p>
<p>保存mysql服务器维护其他所有数据库的信息，比如有哪些表，哪些触发器等等，是一些描述性信息，称之为元数据。</p>
<p>information_schema还提供了一些以innodb_sys开头的表，用于表示内部系统表。</p>
</li>
<li><p><strong>performance_schema</strong></p>
<p>保存MySQL服务器运行过程中的一些状态信息，可以用来 监控 MySQL 服务的各类性能指标 。包括统计最近执行了哪些语句，在执行过程的每个阶段都 花费了多长时间，内存的使用情况等信息。</p>
</li>
<li><p><strong>sys</strong></p>
<p>这个数据库主要是通过 视图 的形式把 information_schema 和 performance_schema 结合起来，帮助系统管理员和开发人员监控 MySQL 的技术性能。</p>
</li>
</ul>
<hr>
<p><strong>表在文件系统中的表示：</strong></p>
<ul>
<li><p>InnoDB存储引擎模式：</p>
<ul>
<li><p><strong>表结构</strong>：</p>
<p>为了保存表结构， InnoDB 在 数据目录 下对应的数据库子目录下创建了一个专门用于 <code>描述表结构的文件</code> ，文件名是这样：<strong>表名.frm</strong></p>
</li>
<li><p><strong>表的数据和索引</strong>：</p>
<ul>
<li><p>系统表空间（5.6.6版本以前）</p>
<p>默认情况下，InnoDB会在数据目录下创建一个名为 ibdata1 、大小为 12M 的文件，这个文件就是对应 的 系统表空间 在文件系统上的表示。它是一个自扩展文件。</p>
</li>
<li><p>独立表空间（5.6.6版本以后）</p>
<p>InnoDB 为每一个表建立一个独立表空间 ，表现为：在该表所属数据库对应的子目录下创建一个表示该独立表空间的文件，文件名和表名相同，为：<strong>表名.ibd</strong></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>MyISAM存储引擎模式：</p>
<ul>
<li><p>表结构：</p>
<p>（同InnoDB一样）</p>
</li>
<li><p>表数据和索引：</p>
<p>在MyISAM中的索引全部都是 <u>二级索引</u> ，该存储引擎的 数据和索引是<u>分开存放</u> 的。所以在文件系统中也是 使用不同的文件来存储数据文件和索引文件，同时表数据都存放在对应的数据库子目录下。</p>
<p>MyISAM存储引擎 会在 表所在数据库对应的 atguigu 目录下 创建这三个文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">表名.frm 存储表结构</span><br><span class="line">表名.MYD 存储数据 (MYData)</span><br><span class="line">表名.MYI 存储索引 (MYIndex)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="用户与权限管理"><a href="#用户与权限管理" class="headerlink" title="用户与权限管理"></a>用户与权限管理</h2><h2 id="逻辑架构"><a href="#逻辑架构" class="headerlink" title="逻辑架构"></a>逻辑架构</h2><h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><h1 id="索引调优"><a href="#索引调优" class="headerlink" title="索引调优"></a>索引调优</h1><h2 id="索引的数据结构"><a href="#索引的数据结构" class="headerlink" title="索引的数据结构"></a>索引的数据结构</h2><h2 id="InnoDB数据存储结构"><a href="#InnoDB数据存储结构" class="headerlink" title="InnoDB数据存储结构"></a>InnoDB数据存储结构</h2><h2 id="索引的创建与设计原则"><a href="#索引的创建与设计原则" class="headerlink" title="索引的创建与设计原则"></a>索引的创建与设计原则</h2><h2 id="性能分析工具的使用"><a href="#性能分析工具的使用" class="headerlink" title="性能分析工具的使用"></a>性能分析工具的使用</h2><h2 id="索引优化与查询优化"><a href="#索引优化与查询优化" class="headerlink" title="索引优化与查询优化"></a>索引优化与查询优化</h2><h2 id="数据库的设计规范"><a href="#数据库的设计规范" class="headerlink" title="数据库的设计规范"></a>数据库的设计规范</h2><h2 id="数据库其他调优策略"><a href="#数据库其他调优策略" class="headerlink" title="数据库其他调优策略"></a>数据库其他调优策略</h2><h1 id="事务-2"><a href="#事务-2" class="headerlink" title="事务"></a>事务</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h2 id="MySQL事务日志"><a href="#MySQL事务日志" class="headerlink" title="MySQL事务日志"></a>MySQL事务日志</h2><h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h2 id="多版本并发控制-MVCC"><a href="#多版本并发控制-MVCC" class="headerlink" title="多版本并发控制(MVCC)"></a>多版本并发控制(MVCC)</h2><h1 id="日志与备份"><a href="#日志与备份" class="headerlink" title="日志与备份"></a>日志与备份</h1><h1 id="mysql优化—作业"><a href="#mysql优化—作业" class="headerlink" title="mysql优化—作业"></a>mysql优化—作业</h1><p>performance_schema 通过监视Server的事件来实现监视其内部执行情况，<strong>“事件”</strong>就是在Server内部活动中所做的任何事情以及对应的时间消耗，利用这些信息来判断Server中的相关资源被消耗在哪里。</p>
<p>performance_schema配置：</p>
<p>performance_schema服务器性能：</p>
<ul>
<li><p><strong>资源</strong></p>
<ul>
<li><strong>磁盘文件</strong></li>
<li><strong>表I&#x2F;O</strong></li>
<li><strong>表锁</strong></li>
<li><strong>资源消耗和等待</strong></li>
</ul>
</li>
<li><p><strong>事件</strong></p>
<ul>
<li><strong>SQL执行：解析，操作，排序</strong></li>
<li><strong>函数调用</strong></li>
<li><strong>操作系统的等待</strong></li>
</ul>
</li>
<li><p><strong>检测</strong></p>
<ul>
<li><strong>检测点</strong></li>
<li><strong>收集事件</strong></li>
<li><strong>内存中存储</strong></li>
<li><strong>select语句查询</strong></li>
</ul>
</li>
<li><p><strong>记录表</strong></p>
<ul>
<li><p><strong>语句事件记录表</strong></p>
<ul>
<li>event_statements_current —— 当前语句事件表</li>
<li>events_statements_history —— 历史语句事件表</li>
<li>events_statements_history_long —— 长语句历史事件表</li>
<li>events_stages_sumary_* —— 聚合后的摘要表（可以根据account，host，thread，user，global进行细分）</li>
</ul>
</li>
<li><p><strong>等待事件记录表</strong></p>
<ul>
<li>events_wait_current —— 当前等待事件，每个线程只保留一条记录，工作结束后不再记录。（主要字段有：THREAD_ID, EVENT_ID, EVENT_NAME, SOURCE 表示该代码在哪个源文件及其行号, TIMER_WAIT 表示总的事件开销）</li>
<li>events_wait_history —— 历史等待事件，记录每个线程已经执行完成的事件(10条，超过覆盖)。（主要字段有：THREAD_ID，EVENT_ID，EVENT_NAME，TIMER_WAIT）</li>
<li>events_wait_history_long —— 记录所有线程的事件信息(10000条，超过覆盖)</li>
<li>event_wait_summary_by_*</li>
</ul>
</li>
<li><p><strong>阶段事件记录表</strong></p>
<ul>
<li>events_stage_current</li>
<li>events_stage_history</li>
<li>events_stage_history_long</li>
<li>events_stage_summary_by_*</li>
</ul>
</li>
<li><p><strong>事务事件记录表</strong></p>
<ul>
<li>events_transaction_current</li>
<li>events_transaction_history</li>
<li>events_transaction_history_long</li>
<li>events_transaction_summary_by_*</li>
</ul>
</li>
<li><p><strong>监视文件系统层调用的表</strong></p>
<ul>
<li><p>file_instances —— 列出了文件I&#x2F;O操作及其关联文件名。</p>
<blockquote>
<p>isntance表记录了哪些类型的对象会被检测。这些对象在被Server使用时，在该表中将会长生一条记录事件。</p>
</blockquote>
</li>
<li><p>file_summary_by_event_name</p>
</li>
<li><p>file_summary_by_instance —— 根据文件对象实例的汇总摘要</p>
</li>
</ul>
</li>
<li><p><strong>监视内存使用的表</strong></p>
<ul>
<li>memory_summary_by_*_by_event_name —— （*处要按account，host，thread，user，global进行细分，如memory_summary_by_account_by_event_name ）</li>
</ul>
</li>
<li><p><strong>动态对performance_schema配置的配置表</strong>（只支持修改和查询，不支持增删）</p>
<ul>
<li>setup_actors —— 表用于配置是否为新的前台Server线程（与客户端连接相关联的线程）启用监视和历史事件日志记录。</li>
<li>setup_consumers —— 包含consumers可配置列表项，对该表的修改会立即影响监控</li>
<li>setup_instruments —— 表示哪些事件支持被收集。</li>
<li>setup_objects —— 控制performance_schema是否监控特定对象</li>
<li>setup_timers —— 记录了当前使用的事件计时器信息</li>
</ul>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ValcanoZz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/04/14/MySQL/">http://example.com/2022/04/14/MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">ValcanoZz Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/Notes/tags/%E5%90%8E%E7%AB%AF/">后端</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205151643159.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Notes/2022/04/14/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><img class="prev-cover" src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205151557250.jpeg" onerror="onerror=null;src='/Notes/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">汇编语言</div></div></a></div><div class="next-post pull-right"><a href="/Notes/2022/04/14/linux/"><img class="next-cover" src="https://raw.githubusercontent.com/ValcanoZz/Notes_image/main/img/202205151642627.jpg" onerror="onerror=null;src='/Notes/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Notes/2022/07/04/Nginx%E5%AD%A6%E4%B9%A0/" title="Nginx学习"><img class="cover" src="https://img.sj33.cn/uploads/202009/7-200923141040512.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-04</div><div class="title">Nginx学习</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NjA4NS8zMjU0OA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL"><span class="toc-number">1.</span> <span class="toc-text">MySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">数据库操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8"><span class="toc-number">3.</span> <span class="toc-text">表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">3.1.</span> <span class="toc-text">表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">3.1.1.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">3.1.2.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.3.</span> <span class="toc-text">添加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.4.</span> <span class="toc-text">查询数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.5.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.6.</span> <span class="toc-text">多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.6.1.</span> <span class="toc-text">自连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.6.2.</span> <span class="toc-text">外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.6.3.</span> <span class="toc-text">自然连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.6.4.</span> <span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.6.5.</span> <span class="toc-text">合并查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%A4%8D%E5%88%B6"><span class="toc-number">3.1.7.</span> <span class="toc-text">表复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%88%97%E5%B1%9E%E6%80%A7"><span class="toc-number">3.1.8.</span> <span class="toc-text">修改列属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.9.</span> <span class="toc-text">更新数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.10.</span> <span class="toc-text">删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.2.</span> <span class="toc-text">约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#primary-key-%E4%B8%BB%E9%94%AE"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">primary key (主键)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#not-null-%E9%9D%9E%E7%A9%BA"><span class="toc-number">3.2.0.2.</span> <span class="toc-text">not null (非空)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unique-%E5%94%AF%E4%B8%80"><span class="toc-number">3.2.0.3.</span> <span class="toc-text">unique (唯一)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#foreign-key-%E5%A4%96%E9%94%AE"><span class="toc-number">3.2.0.4.</span> <span class="toc-text">foreign key (外键)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#check"><span class="toc-number">3.2.0.5.</span> <span class="toc-text">check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#default"><span class="toc-number">3.2.0.6.</span> <span class="toc-text">default</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">3.3.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">3.4.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-number">3.4.0.1.</span> <span class="toc-text">事务操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">3.4.0.2.</span> <span class="toc-text">事务隔离级别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%B1%BB%E5%9E%8B-x2F-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">3.5.</span> <span class="toc-text">表类型&#x2F;存储引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">3.6.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">3.7.</span> <span class="toc-text">用户管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">统计函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">4.2.</span> <span class="toc-text">分组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">4.4.</span> <span class="toc-text">数学函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.</span> <span class="toc-text">日期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">加密函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">4.7.</span> <span class="toc-text">流程函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-number">4.8.</span> <span class="toc-text">其他函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">存储过程和存储函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">5.1.</span> <span class="toc-text">存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">存储函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">7.</span> <span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">7.1.</span> <span class="toc-text">系统变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-number">7.2.</span> <span class="toc-text">用户变量</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-number">8.</span> <span class="toc-text">处理错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.0.1.</span> <span class="toc-text">定义条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">8.0.2.</span> <span class="toc-text">定义处理程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E6%B8%B8%E6%A0%87"><span class="toc-number">9.</span> <span class="toc-text">流程控制与游标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">9.1.</span> <span class="toc-text">游标</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">10.</span> <span class="toc-text">触发器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JDBC"><span class="toc-number">11.</span> <span class="toc-text">JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4"><span class="toc-number">11.0.1.</span> <span class="toc-text">JDBC程序编写步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-number">11.0.2.</span> <span class="toc-text">获取数据库连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC-API"><span class="toc-number">11.0.3.</span> <span class="toc-text">JDBC API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DriverManger"><span class="toc-number">11.0.3.1.</span> <span class="toc-text">DriverManger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Connection-%E6%8E%A5%E5%8F%A3"><span class="toc-number">11.0.3.2.</span> <span class="toc-text">Connection 接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Statement"><span class="toc-number">11.0.3.3.</span> <span class="toc-text">Statement</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreparedStatement"><span class="toc-number">11.0.3.4.</span> <span class="toc-text">PreparedStatement</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ResultSet"><span class="toc-number">11.0.3.5.</span> <span class="toc-text">ResultSet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBCUtils-%E5%B0%81%E8%A3%85"><span class="toc-number">11.0.4.</span> <span class="toc-text">JDBCUtils(封装)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-1"><span class="toc-number">11.0.5.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-number">11.0.6.</span> <span class="toc-text">批处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">11.0.7.</span> <span class="toc-text">数据库连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#C3P0"><span class="toc-number">11.0.7.1.</span> <span class="toc-text">C3P0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Druid"><span class="toc-number">11.0.7.2.</span> <span class="toc-text">Druid</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DBUtils"><span class="toc-number">11.0.8.</span> <span class="toc-text">DBUtils</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DAO"><span class="toc-number">11.0.9.</span> <span class="toc-text">DAO</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">12.</span> <span class="toc-text">架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95"><span class="toc-number">12.1.</span> <span class="toc-text">MySQL的数据目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">12.2.</span> <span class="toc-text">用户与权限管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84"><span class="toc-number">12.3.</span> <span class="toc-text">逻辑架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">12.4.</span> <span class="toc-text">存储引擎</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%B0%83%E4%BC%98"><span class="toc-number">13.</span> <span class="toc-text">索引调优</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">13.1.</span> <span class="toc-text">索引的数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">13.2.</span> <span class="toc-text">InnoDB数据存储结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">13.3.</span> <span class="toc-text">索引的创建与设计原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">13.4.</span> <span class="toc-text">性能分析工具的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E4%B8%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">13.5.</span> <span class="toc-text">索引优化与查询优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83"><span class="toc-number">13.6.</span> <span class="toc-text">数据库的设计规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B6%E4%BB%96%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5"><span class="toc-number">13.7.</span> <span class="toc-text">数据库其他调优策略</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-2"><span class="toc-number">14.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">14.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-number">14.2.</span> <span class="toc-text">MySQL事务日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">14.3.</span> <span class="toc-text">锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6-MVCC"><span class="toc-number">14.4.</span> <span class="toc-text">多版本并发控制(MVCC)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E4%B8%8E%E5%A4%87%E4%BB%BD"><span class="toc-number">15.</span> <span class="toc-text">日志与备份</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E4%BC%98%E5%8C%96%E2%80%94%E4%BD%9C%E4%B8%9A"><span class="toc-number">16.</span> <span class="toc-text">mysql优化—作业</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By ValcanoZz</div><div class="footer_custom_text"><div><a onclick="window.open('https://beian.miit.gov.cn/#/Integrated/index')" >粤ICP备2022110986号-1</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/Notes/js/utils.js"></script><script src="/Notes/js/main.js"></script><script src="/Notes/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/Notes/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>